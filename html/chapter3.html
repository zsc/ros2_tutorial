<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>ç¬¬ 3 ç« ï¼šä» ROS1 åˆ° ROS2 çš„è¿ç§»ç­–ç•¥</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>ç›®å½•</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="æœç´¢..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ROS2 å®Œå…¨æ•™ç¨‹ï¼šä»åŸç†åˆ°å®è·µ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 1 ç« ï¼šROS1 æ ¸å¿ƒæ¦‚å¿µå›é¡¾</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 2 ç« ï¼šROS1 çš„å±€é™æ€§åˆ†æ</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 3 ç« ï¼šä» ROS1 åˆ° ROS2 çš„è¿ç§»ç­–ç•¥</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 4 ç« ï¼šROS2 æ¶æ„ä¸è®¾è®¡ç†å¿µ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 5 ç« ï¼šèŠ‚ç‚¹ä¸æ‰§è¡Œå™¨æ¨¡å‹</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 6 ç« ï¼šé€šä¿¡æœºåˆ¶æ·±åº¦è§£æ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 7 ç« ï¼šLaunch ç³»ç»Ÿä¸é…ç½®ç®¡ç†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 8 ç« ï¼štf2 åæ ‡å˜æ¢æ¡†æ¶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 9 ç« ï¼šæ—¶é—´åŒæ­¥ä¸å›æ”¾ç³»ç»Ÿ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 10 ç« ï¼šä¼ æ„Ÿå™¨æ•°æ®å¤„ç†ç®¡é“</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 11 ç« ï¼šSLAM ä¸å®šä½ç³»ç»Ÿ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 12 ç« ï¼šå¯¼èˆªæ ˆ Nav2</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 13 ç« ï¼šros2_control æ¡†æ¶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter14.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 14 ç« ï¼šMoveIt2 è¿åŠ¨è§„åˆ’</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter15.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 15 ç« ï¼šå®æ—¶ç³»ç»Ÿä¸æ€§èƒ½ä¼˜åŒ–</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter16.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 16 ç« ï¼šå®‰å…¨æ€§ä¸è¯Šæ–­ç³»ç»Ÿ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter17.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 17 ç« ï¼šä»¿çœŸé›†æˆï¼ˆGazebo/Ignitionï¼‰</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter18.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 18 ç« ï¼šå¤šæœºå™¨äººç³»ç»Ÿ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter19.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 19 ç« ï¼šè®¡ç®—æœºè§†è§‰ä¸æ·±åº¦å­¦ä¹ </span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter20.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 20 ç« ï¼šæœºå™¨äººå¼ºåŒ–å­¦ä¹ </span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter21.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 21 ç« ï¼šå¤§è¯­è¨€æ¨¡å‹ä¸å…·èº«æ™ºèƒ½</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter22.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 22 ç« ï¼šç¥ç»ç½‘ç»œè¿åŠ¨æ§åˆ¶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="3-ros1-ros2">ç¬¬ 3 ç« ï¼šä» ROS1 åˆ° ROS2 çš„è¿ç§»ç­–ç•¥</h1>
<p>åœ¨å‰ä¸¤ç« ä¸­ï¼Œæˆ‘ä»¬å›é¡¾äº† ROS1 çš„æ ¸å¿ƒæ¶æ„å¹¶æ·±å…¥åˆ†æäº†å…¶åœ¨å®é™…å·¥ä¸šåº”ç”¨ä¸­æš´éœ²çš„å±€é™æ€§ã€‚æœ¬ç« å°†èšç„¦äºå®é™…çš„è¿ç§»ç­–ç•¥ï¼Œä¸ºé‚£äº›éœ€è¦å°†ç°æœ‰ ROS1 ç³»ç»Ÿå‡çº§åˆ° ROS2 çš„å›¢é˜Ÿæä¾›ç³»ç»ŸåŒ–çš„æŒ‡å¯¼ã€‚è¿ç§»ä¸ä»…ä»…æ˜¯ä»£ç å±‚é¢çš„æ”¹å†™ï¼Œæ›´æ¶‰åŠæ¶æ„è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ã€å›¢é˜Ÿåä½œç­‰å¤šä¸ªç»´åº¦çš„è€ƒé‡ã€‚æˆ‘ä»¬å°†é€šè¿‡ Toyota HSRï¼ˆHuman Support Robotï¼‰çš„å®é™…è¿ç§»æ¡ˆä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ä¿è¯ç³»ç»Ÿç¨³å®šæ€§çš„å‰æä¸‹ï¼Œé€æ­¥å®Œæˆè¿™ä¸€å¤æ‚çš„å·¥ç¨‹ä»»åŠ¡ã€‚</p>
<h2 id="31">3.1 è¿ç§»è¯„ä¼°ä¸å†³ç­–æ¡†æ¶</h2>
<p>åœ¨å¼€å§‹ä»»ä½•è¿ç§»å·¥ä½œä¹‹å‰ï¼Œé¦–è¦ä»»åŠ¡æ˜¯å…¨é¢è¯„ä¼°ç°æœ‰ç³»ç»Ÿå¹¶åˆ¶å®šåˆç†çš„è¿ç§»ç­–ç•¥ã€‚è¿™ä¸ªè¯„ä¼°è¿‡ç¨‹éœ€è¦è€ƒè™‘æŠ€æœ¯å€ºåŠ¡ã€ä¸šåŠ¡è¿ç»­æ€§ã€å›¢é˜ŸæŠ€èƒ½å‚¨å¤‡ç­‰å¤šä¸ªå› ç´ ã€‚</p>
<h3 id="311">3.1.1 ç³»ç»Ÿå¤æ‚åº¦è¯„ä¼°çŸ©é˜µ</h3>
<div class="codehilite"><pre><span></span><code>å¤æ‚åº¦è¯„åˆ† = Î±Â·èŠ‚ç‚¹æ•°é‡ + Î²Â·è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹ + Î³Â·å¤–éƒ¨ä¾èµ– + Î´Â·å®æ—¶æ€§è¦æ±‚
</code></pre></div>

<p>å…¶ä¸­æƒé‡ç³»æ•° $\alpha = 0.2, \beta = 0.3, \gamma = 0.3, \delta = 0.2$ æ˜¯åŸºäºå·¥ä¸šå®è·µçš„ç»éªŒå€¼ã€‚</p>
<h3 id="312">3.1.2 è¿ç§»æ”¶ç›Šåˆ†æ</h3>
<p>è¿ç§»åˆ° ROS2 çš„ä¸»è¦æ”¶ç›ŠåŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>å®æ—¶æ€§æå‡</strong>ï¼šDDS ä¸­é—´ä»¶æ”¯æŒç¡®å®šæ€§é€šä¿¡ï¼Œå»¶è¿Ÿå¯é¢„æµ‹æ€§æå‡ 10 å€</li>
<li><strong>å®‰å…¨æ€§å¢å¼º</strong>ï¼šSROS2 æä¾›ç«¯åˆ°ç«¯åŠ å¯†ï¼Œæ»¡è¶³ ISO 26262 åŠŸèƒ½å®‰å…¨è¦æ±‚</li>
<li><strong>å¯æ‰©å±•æ€§æ”¹å–„</strong>ï¼šå»ä¸­å¿ƒåŒ–æ¶æ„æ¶ˆé™¤ Master å•ç‚¹æ•…éšœï¼Œæ”¯æŒ 1000+ èŠ‚ç‚¹é›†ç¾¤</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šæ ‡å‡†åŒ–çš„èŠ‚ç‚¹çŠ¶æ€æœºï¼Œç®€åŒ–å¤æ‚ç³»ç»Ÿçš„å¯åŠ¨å’Œå…³é—­æµç¨‹</li>
</ol>
<h3 id="313">3.1.3 é£é™©è¯„ä¼°æ¸…å•</h3>
<ul>
<li>ç¬¬ä¸‰æ–¹åŒ…ä¾èµ–çš„ ROS2 æ”¯æŒæƒ…å†µ</li>
<li>å›¢é˜Ÿçš„ Modern C++ (C++14/17) æŒæ¡ç¨‹åº¦</li>
<li>å®æ—¶æ€§æµ‹è¯•åŸºç¡€è®¾æ–½çš„å®Œå¤‡æ€§</li>
<li>å›æ»šæ–¹æ¡ˆçš„å¯è¡Œæ€§</li>
</ul>
<h2 id="32-ros1_bridge">3.2 ros1_bridge æ¡¥æ¥æ–¹æ¡ˆ</h2>
<p>ros1_bridge æ˜¯å®˜æ–¹æä¾›çš„ ROS1 å’Œ ROS2 äº’æ“ä½œæ€§è§£å†³æ–¹æ¡ˆï¼Œå®ƒå…è®¸ä¸¤ä¸ªç‰ˆæœ¬çš„èŠ‚ç‚¹åœ¨åŒä¸€ç³»ç»Ÿä¸­å…±å­˜å¹¶ç›¸äº’é€šä¿¡ã€‚è¿™ä¸ºæ¸è¿›å¼è¿ç§»æä¾›äº†æŠ€æœ¯åŸºç¡€ã€‚</p>
<h3 id="321">3.2.1 æ¡¥æ¥æ¶æ„åŸç†</h3>
<p>ros1_bridge æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŒå‘åè®®è½¬æ¢å™¨ï¼Œå®ƒåŒæ—¶è¿è¡Œ ROS1 å’Œ ROS2 çš„å®¢æˆ·ç«¯åº“ï¼š</p>
<div class="codehilite"><pre><span></span><code>     ROS1 Domain                    ROS2 Domain
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ROS1 Nodeâ”‚                  â”‚ ROS2 Nodeâ”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
          â”‚                             â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚          ros1_bridge                  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚  ROS1 Clientâ”‚  â”‚  ROS2 Clientâ”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚         â”‚                 â”‚          â”‚
    â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”‚
    â”‚    â”‚   Message Type Mapping    â”‚    â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="322">3.2.2 æ¶ˆæ¯ç±»å‹æ˜ å°„æœºåˆ¶</h3>
<p>æ¡¥æ¥å™¨ç»´æŠ¤äº†ä¸€ä¸ªæ¶ˆæ¯ç±»å‹æ˜ å°„è¡¨ï¼Œæ”¯æŒä¸‰ç§æ˜ å°„æ¨¡å¼ï¼š</p>
<ol>
<li><strong>ç›´æ¥æ˜ å°„</strong>ï¼šå­—æ®µåç§°å’Œç±»å‹å®Œå…¨ä¸€è‡´</li>
<li><strong>è§„åˆ™æ˜ å°„</strong>ï¼šé€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰å­—æ®µè½¬æ¢è§„åˆ™</li>
<li><strong>è‡ªå®šä¹‰æ˜ å°„</strong>ï¼šç¼–å†™ C++ è½¬æ¢å‡½æ•°å¤„ç†å¤æ‚é€»è¾‘</li>
</ol>
<p>æ˜ å°„é…ç½®ç¤ºä¾‹ï¼ˆYAML æ ¼å¼ï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="nt">ros1_package_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;geometry_msgs&#39;</span>
<span class="nt">ros1_message_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Twist&#39;</span>
<span class="nt">ros2_package_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;geometry_msgs&#39;</span>
<span class="nt">ros2_message_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;msg/Twist&#39;</span>
<span class="nt">fields_1_to_2</span><span class="p">:</span>
<span class="w">  </span><span class="nt">linear</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;linear&#39;</span>
<span class="w">  </span><span class="nt">angular</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;angular&#39;</span>
</code></pre></div>

<h3 id="323">3.2.3 æ€§èƒ½ç‰¹æ€§ä¸ä¼˜åŒ–</h3>
<p>æ¡¥æ¥å™¨çš„æ€§èƒ½å¼€é”€ä¸»è¦æ¥è‡ªï¼š</p>
<ol>
<li><strong>åºåˆ—åŒ–/ååºåˆ—åŒ–å¼€é”€</strong>ï¼šçº¦ 10-20 Î¼s/æ¶ˆæ¯ï¼ˆ1KB è´Ÿè½½ï¼‰</li>
<li><strong>ç±»å‹è½¬æ¢å¼€é”€</strong>ï¼šå–å†³äºæ˜ å°„å¤æ‚åº¦ï¼Œå…¸å‹å€¼ 5-15 Î¼s</li>
<li><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€</strong>ï¼šROS1 å’Œ ROS2 äº‹ä»¶å¾ªç¯åˆ‡æ¢ï¼Œçº¦ 20-30 Î¼s</li>
</ol>
<p>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š</p>
<ul>
<li><strong>æ‰¹é‡ä¼ è¾“</strong>ï¼šèšåˆå¤šä¸ªå°æ¶ˆæ¯å‡å°‘å¼€é”€</li>
<li><strong>å»¶è¿Ÿè®¢é˜…</strong>ï¼šä»…åœ¨æœ‰è®¢é˜…è€…æ—¶æ‰å»ºç«‹æ¡¥æ¥</li>
<li><strong>QoS åŒ¹é…</strong>ï¼šåˆç†é…ç½® DDS QoS å‡å°‘é‡ä¼ </li>
</ul>
<h3 id="324">3.2.4 åŠ¨æ€æ¡¥æ¥ä¸é™æ€æ¡¥æ¥</h3>
<p><strong>åŠ¨æ€æ¡¥æ¥</strong>ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ï¼š</p>
<ul>
<li>è¿è¡Œæ—¶è‡ªåŠ¨å‘ç°éœ€è¦æ¡¥æ¥çš„è¯é¢˜å’ŒæœåŠ¡</li>
<li>çµæ´»ä½†æœ‰ä¸€å®šæ€§èƒ½å¼€é”€</li>
<li>é€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ</li>
</ul>
<p><strong>é™æ€æ¡¥æ¥</strong>ï¼ˆå‚æ•°åŒ–æ¨¡å¼ï¼‰ï¼š</p>
<ul>
<li>é¢„å…ˆæŒ‡å®šéœ€è¦æ¡¥æ¥çš„æ¥å£</li>
<li>æ€§èƒ½æ›´ä¼˜ï¼Œå¯åŠ¨æ›´å¿«</li>
<li>é€‚åˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</li>
</ul>
<p>é™æ€æ¡¥æ¥å¯åŠ¨ç¤ºä¾‹ï¼š</p>
<div class="codehilite"><pre><span></span><code>ros2<span class="w"> </span>run<span class="w"> </span>ros1_bridge<span class="w"> </span>parameter_bridge<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>/cmd_vel@geometry_msgs/msg/Twist@geometry_msgs/Twist<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>/scan@sensor_msgs/msg/LaserScan@sensor_msgs/LaserScan
</code></pre></div>

<h2 id="33">3.3 ä»£ç ç§»æ¤æœ€ä½³å®è·µ</h2>
<p>ä» ROS1 åˆ° ROS2 çš„ä»£ç ç§»æ¤æ¶‰åŠ API å˜åŒ–ã€ç¼–ç¨‹èŒƒå¼è½¬å˜å’Œæ„å»ºç³»ç»Ÿè¿ç§»ç­‰å¤šä¸ªæ–¹é¢ã€‚</p>
<h3 id="331-api">3.3.1 æ ¸å¿ƒ API å¯¹ç…§è¡¨</h3>
<p>| ROS1 API | ROS2 API | ä¸»è¦å·®å¼‚ |</p>
<table>
<thead>
<tr>
<th>ROS1 API</th>
<th>ROS2 API</th>
<th>ä¸»è¦å·®å¼‚</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ros::init()</code></td>
<td><code>rclcpp::init()</code></td>
<td>ROS2 æ”¯æŒå¤šå®ä¾‹</td>
</tr>
<tr>
<td><code>ros::NodeHandle</code></td>
<td><code>rclcpp::Node</code></td>
<td>èŠ‚ç‚¹æˆä¸ºä¸€ç­‰å…¬æ°‘</td>
</tr>
<tr>
<td><code>ros::Publisher</code></td>
<td><code>rclcpp::Publisher&lt;T&gt;</code></td>
<td>å¼ºç±»å‹æ¨¡æ¿</td>
</tr>
<tr>
<td><code>ros::Subscriber</code></td>
<td><code>rclcpp::Subscription&lt;T&gt;</code></td>
<td>æ™ºèƒ½æŒ‡é’ˆç®¡ç†</td>
</tr>
<tr>
<td><code>ros::ServiceServer</code></td>
<td><code>rclcpp::Service&lt;T&gt;</code></td>
<td>ç±»å‹å®‰å…¨å¢å¼º</td>
</tr>
<tr>
<td><code>ros::Rate</code></td>
<td><code>rclcpp::Rate</code></td>
<td>æ”¯æŒå¤šç§æ—¶é’Ÿæº</td>
</tr>
<tr>
<td><code>ros::Time::now()</code></td>
<td><code>node-&gt;now()</code></td>
<td>æ—¶é—´ä¸èŠ‚ç‚¹å…³è”</td>
</tr>
<tr>
<td><code>ros::param::get()</code></td>
<td><code>node-&gt;declare_parameter()</code></td>
<td>å‚æ•°éœ€è¦å£°æ˜</td>
</tr>
</tbody>
</table>
<h3 id="332">3.3.2 ç¼–ç¨‹èŒƒå¼è½¬å˜</h3>
<p><strong>ROS1 å‡½æ•°å¼é£æ ¼</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ROS1</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std_msgs</span><span class="o">::</span><span class="n">String</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;I heard: [%s]&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;listener&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;chatter&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">);</span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">spin</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>ROS2 é¢å‘å¯¹è±¡é£æ ¼</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ROS2</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MinimalSubscriber</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">MinimalSubscriber</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="s">&quot;minimal_subscriber&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">subscription_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MinimalSubscriber</span><span class="o">::</span><span class="n">callback</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">String</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;I heard: &#39;%s&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">String</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">subscription_</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="333">3.3.3 å‚æ•°ç³»ç»Ÿè¿ç§»</h3>
<p>ROS2 çš„å‚æ•°ç³»ç»Ÿæ›´åŠ ä¸¥æ ¼å’Œç±»å‹å®‰å…¨ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ROS1 - è¿è¡Œæ—¶åŠ¨æ€è·å–</span>
<span class="kt">double</span><span class="w"> </span><span class="n">param</span><span class="p">;</span>
<span class="n">nh</span><span class="p">.</span><span class="n">param</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;my_param&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">param</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>

<span class="c1">// ROS2 - éœ€è¦å…ˆå£°æ˜</span>
<span class="k">this</span><span class="o">-&gt;</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s">&quot;my_param&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="kt">double</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="s">&quot;my_param&quot;</span><span class="p">).</span><span class="n">as_double</span><span class="p">();</span>

<span class="c1">// ROS2 - å‚æ•°å˜æ›´å›è°ƒ</span>
<span class="k">auto</span><span class="w"> </span><span class="n">param_callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Parameter</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="p">.</span><span class="n">get_name</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;my_param&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// å¤„ç†å‚æ•°æ›´æ–°</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">SetParametersResult</span><span class="p">();</span>
<span class="p">};</span>
<span class="n">callback_handle_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">add_on_set_parameters_callback</span><span class="p">(</span><span class="n">param_callback</span><span class="p">);</span>
</code></pre></div>

<h3 id="334">3.3.4 æœåŠ¡å’ŒåŠ¨ä½œè¿ç§»</h3>
<p><strong>æœåŠ¡è¿ç§»è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>ROS2 æœåŠ¡ä½¿ç”¨ Promise/Future æ¨¡å¼æ”¯æŒå¼‚æ­¥è°ƒç”¨</li>
<li>è¯·æ±‚å’Œå“åº”åˆ†ç¦»ä¸ºç‹¬ç«‹çš„æ¶ˆæ¯ç±»å‹</li>
<li>æ”¯æŒæœåŠ¡è´¨é‡ï¼ˆQoSï¼‰é…ç½®</li>
</ul>
<p><strong>åŠ¨ä½œè¿ç§»å·®å¼‚</strong>ï¼š</p>
<ul>
<li>ROS2 åŠ¨ä½œåŸºäºæœåŠ¡å’Œè¯é¢˜å®ç°ï¼Œæ›´åŠ è½»é‡</li>
<li>å†…ç½®å–æ¶ˆæœºåˆ¶å’Œç›®æ ‡ UUID ç®¡ç†</li>
<li>åé¦ˆé¢‘ç‡å¯é…ç½®</li>
</ul>
<h2 id="34-catkin-vs-colcon">3.4 å·¥å…·é“¾å¯¹æ¯”ï¼ˆcatkin vs colconï¼‰</h2>
<p>æ„å»ºç³»ç»Ÿçš„è¿ç§»æ˜¯ ROS1 åˆ° ROS2 è½¬æ¢ä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚ç†è§£ä¸¤ä¸ªæ„å»ºç³»ç»Ÿçš„å·®å¼‚å¯¹äºé¡ºåˆ©è¿ç§»è‡³å…³é‡è¦ã€‚</p>
<h3 id="341">3.4.1 æ„å»ºç³»ç»Ÿæ¶æ„å¯¹æ¯”</h3>
<p><strong>Catkin (ROS1)</strong>ï¼š</p>
<ul>
<li>åŸºäº CMake çš„å…ƒæ„å»ºç³»ç»Ÿ</li>
<li>å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„å·¥ä½œç©ºé—´å¸ƒå±€</li>
<li>æ‰€æœ‰åŒ…å…±äº«åŒä¸€ä¸ª CMake ä¸Šä¸‹æ–‡</li>
<li>æ„å»ºé¡ºåºç”±æ‹“æ‰‘æ’åºè‡ªåŠ¨å†³å®š</li>
</ul>
<p><strong>Colcon (ROS2)</strong>ï¼š</p>
<ul>
<li>é€šç”¨çš„æ„å»ºå·¥å…·ï¼Œæ”¯æŒå¤šç§æ„å»ºç³»ç»Ÿ</li>
<li>çµæ´»çš„å·¥ä½œç©ºé—´ç»“æ„</li>
<li>æ¯ä¸ªåŒ…ç‹¬ç«‹æ„å»ºï¼Œå¹¶è¡Œåº¦æ›´é«˜</li>
<li>æ”¯æŒ CMakeã€Python setuptoolsã€Cargo ç­‰</li>
</ul>
<p>æ¶æ„å·®å¼‚ç¤ºæ„ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Catkin</span><span class="w"> </span><span class="nx">å·¥ä½œç©ºé—´</span><span class="p">:</span><span class="w">                    </span><span class="nx">Colcon</span><span class="w"> </span><span class="nx">å·¥ä½œç©ºé—´</span><span class="p">:</span>
<span class="nx">workspace</span><span class="o">/</span><span class="w">                          </span><span class="nx">workspace</span><span class="o">/</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">src</span><span class="o">/</span><span class="w">                           </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">src</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">package1</span><span class="o">/</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">package1</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="nx">package2</span><span class="o">/</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="nx">package2</span><span class="o">/</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">build</span><span class="o">/</span><span class="w">        </span><span class="p">(</span><span class="nx">å…±äº«</span><span class="p">)</span><span class="w">            </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">build</span><span class="o">/</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">devel</span><span class="o">/</span><span class="w">        </span><span class="p">(</span><span class="nx">å¼€å‘ç©ºé—´</span><span class="p">)</span><span class="w">        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">package1</span><span class="o">/</span><span class="w">  </span><span class="p">(</span><span class="nx">ç‹¬ç«‹</span><span class="p">)</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="nx">install</span><span class="o">/</span><span class="w">      </span><span class="p">(</span><span class="nx">å¯é€‰</span><span class="p">)</span><span class="w">            </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="nx">package2</span><span class="o">/</span><span class="w">  </span><span class="p">(</span><span class="nx">ç‹¬ç«‹</span><span class="p">)</span>
<span class="w">                                   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">install</span><span class="o">/</span>
<span class="w">                                   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="nx">log</span><span class="o">/</span><span class="w">          </span><span class="p">(</span><span class="nx">æ„å»ºæ—¥å¿—</span><span class="p">)</span>
</code></pre></div>

<h3 id="342-cmakeliststxt">3.4.2 CMakeLists.txt è¿ç§»æŒ‡å—</h3>
<p><strong>ROS1 CMakeLists.txt å…¸å‹ç»“æ„</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.0.2</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">my_package</span><span class="p">)</span>

<span class="nb">find_package</span><span class="p">(</span><span class="s">catkin</span><span class="w"> </span><span class="s">REQUIRED</span><span class="w"> </span><span class="s">COMPONENTS</span>
<span class="w">  </span><span class="s">roscpp</span>
<span class="w">  </span><span class="s">std_msgs</span>
<span class="w">  </span><span class="s">message_generation</span>
<span class="p">)</span>

<span class="nb">add_message_files</span><span class="p">(</span>
<span class="w">  </span><span class="s">FILES</span>
<span class="w">  </span><span class="s">MyMessage.msg</span>
<span class="p">)</span>

<span class="nb">generate_messages</span><span class="p">(</span>
<span class="w">  </span><span class="s">DEPENDENCIES</span>
<span class="w">  </span><span class="s">std_msgs</span>
<span class="p">)</span>

<span class="nb">catkin_package</span><span class="p">(</span>
<span class="w">  </span><span class="s">INCLUDE_DIRS</span><span class="w"> </span><span class="s">include</span>
<span class="w">  </span><span class="s">LIBRARIES</span><span class="w"> </span><span class="s">my_library</span>
<span class="w">  </span><span class="s">CATKIN_DEPENDS</span><span class="w"> </span><span class="s">roscpp</span><span class="w"> </span><span class="s">std_msgs</span><span class="w"> </span><span class="s">message_runtime</span>
<span class="p">)</span>

<span class="nb">include_directories</span><span class="p">(</span>
<span class="w">  </span><span class="s">include</span>
<span class="w">  </span><span class="o">${</span><span class="nv">catkin_INCLUDE_DIRS</span><span class="o">}</span>
<span class="p">)</span>

<span class="nb">add_library</span><span class="p">(</span><span class="s">my_library</span><span class="w"> </span><span class="s">src/my_library.cpp</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">my_node</span><span class="w"> </span><span class="s">src/my_node.cpp</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">my_node</span><span class="w"> </span><span class="o">${</span><span class="nv">catkin_LIBRARIES</span><span class="o">}</span><span class="p">)</span>
</code></pre></div>

<p><strong>ROS2 CMakeLists.txt å¯¹åº”ç»“æ„</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.8</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">my_package</span><span class="p">)</span>

<span class="c"># é»˜è®¤ä½¿ç”¨ C++14</span>
<span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">CMAKE_CXX_STANDARD</span><span class="p">)</span>
<span class="w">  </span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_STANDARD</span><span class="w"> </span><span class="s">14</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">rclcpp</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">std_msgs</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">rosidl_default_generators</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>

<span class="c"># æ¶ˆæ¯ç”Ÿæˆ</span>
<span class="nb">rosidl_generate_interfaces</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="w">  </span><span class="s2">&quot;msg/MyMessage.msg&quot;</span>
<span class="w">  </span><span class="s">DEPENDENCIES</span><span class="w"> </span><span class="s">std_msgs</span>
<span class="p">)</span>

<span class="c"># åº“å’Œå¯æ‰§è¡Œæ–‡ä»¶</span>
<span class="nb">add_library</span><span class="p">(</span><span class="s">my_library</span><span class="w"> </span><span class="s">src/my_library.cpp</span><span class="p">)</span>
<span class="nb">ament_target_dependencies</span><span class="p">(</span><span class="s">my_library</span><span class="w"> </span><span class="s">rclcpp</span><span class="w"> </span><span class="s">std_msgs</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="s">my_node</span><span class="w"> </span><span class="s">src/my_node.cpp</span><span class="p">)</span>
<span class="nb">ament_target_dependencies</span><span class="p">(</span><span class="s">my_node</span><span class="w"> </span><span class="s">rclcpp</span><span class="w"> </span><span class="s">std_msgs</span><span class="p">)</span>

<span class="c"># ç¡®ä¿æ¶ˆæ¯ç”Ÿæˆåœ¨ç¼–è¯‘å‰å®Œæˆ</span>
<span class="nb">rosidl_target_interfaces</span><span class="p">(</span><span class="s">my_node</span><span class="w"> </span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s2">&quot;rosidl_typesupport_cpp&quot;</span><span class="p">)</span>

<span class="c"># å®‰è£…</span>
<span class="nb">install</span><span class="p">(</span><span class="s">TARGETS</span>
<span class="w">  </span><span class="s">my_library</span>
<span class="w">  </span><span class="s">my_node</span>
<span class="w">  </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">lib/</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="p">)</span>

<span class="nb">install</span><span class="p">(</span><span class="s">DIRECTORY</span><span class="w"> </span><span class="s">include/</span>
<span class="w">  </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">include</span>
<span class="p">)</span>

<span class="nb">ament_package</span><span class="p">()</span>
</code></pre></div>

<h3 id="343-packagexml">3.4.3 åŒ…æ¸…å•è¿ç§»ï¼ˆpackage.xmlï¼‰</h3>
<p><strong>ç‰ˆæœ¬æ ¼å¼å˜åŒ–</strong>ï¼š</p>
<ul>
<li>ROS1: format 2</li>
<li>ROS2: format 3</li>
</ul>
<p><strong>ä¾èµ–å£°æ˜å·®å¼‚</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="cm">&lt;!-- ROS1 package.xml --&gt;</span>
<span class="nt">&lt;package</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>my_package<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>0.0.1<span class="nt">&lt;/version&gt;</span>
<span class="w">  </span><span class="nt">&lt;description&gt;</span>Package<span class="w"> </span>description<span class="nt">&lt;/description&gt;</span>

<span class="w">  </span><span class="nt">&lt;buildtool_depend&gt;</span>catkin<span class="nt">&lt;/buildtool_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;build_depend&gt;</span>roscpp<span class="nt">&lt;/build_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;build_depend&gt;</span>message_generation<span class="nt">&lt;/build_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;exec_depend&gt;</span>message_runtime<span class="nt">&lt;/exec_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;depend&gt;</span>std_msgs<span class="nt">&lt;/depend&gt;</span>
<span class="nt">&lt;/package&gt;</span>

<span class="cm">&lt;!-- ROS2 package.xml --&gt;</span>
<span class="nt">&lt;package</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>my_package<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>0.0.1<span class="nt">&lt;/version&gt;</span>
<span class="w">  </span><span class="nt">&lt;description&gt;</span>Package<span class="w"> </span>description<span class="nt">&lt;/description&gt;</span>

<span class="w">  </span><span class="nt">&lt;buildtool_depend&gt;</span>ament_cmake<span class="nt">&lt;/buildtool_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;depend&gt;</span>rclcpp<span class="nt">&lt;/depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;depend&gt;</span>std_msgs<span class="nt">&lt;/depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;build_depend&gt;</span>rosidl_default_generators<span class="nt">&lt;/build_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;exec_depend&gt;</span>rosidl_default_runtime<span class="nt">&lt;/exec_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;member_of_group&gt;</span>rosidl_interface_packages<span class="nt">&lt;/member_of_group&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</code></pre></div>

<h3 id="344">3.4.4 æ„å»ºå‘½ä»¤å¯¹æ¯”ä¸è¿ç§»</h3>
<p>| æ“ä½œ | Catkin (ROS1) | Colcon (ROS2) |</p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>Catkin (ROS1)</th>
<th>Colcon (ROS2)</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ„å»ºæ‰€æœ‰åŒ…</td>
<td><code>catkin_make</code></td>
<td><code>colcon build</code></td>
</tr>
<tr>
<td>æ„å»ºå•ä¸ªåŒ…</td>
<td><code>catkin_make --pkg &lt;pkg&gt;</code></td>
<td><code>colcon build --packages-select &lt;pkg&gt;</code></td>
</tr>
<tr>
<td>æ¸…ç†æ„å»º</td>
<td><code>catkin_make clean</code></td>
<td><code>rm -rf build install log</code></td>
</tr>
<tr>
<td>å¹¶è¡Œæ„å»º</td>
<td><code>catkin_make -j4</code></td>
<td><code>colcon build --parallel-workers 4</code></td>
</tr>
<tr>
<td>ç¬¦å·é“¾æ¥å®‰è£…</td>
<td><code>catkin_make install</code></td>
<td><code>colcon build --symlink-install</code></td>
</tr>
<tr>
<td>æ„å»ºæµ‹è¯•</td>
<td><code>catkin_make run_tests</code></td>
<td><code>colcon test</code></td>
</tr>
<tr>
<td>æŸ¥çœ‹æ„å»ºæ—¥å¿—</td>
<td><code>catkin_make 2&gt;&amp;1 \| tee log</code></td>
<td><code>cat log/latest_build/events.log</code></td>
</tr>
</tbody>
</table>
<h3 id="345">3.4.5 ç¯å¢ƒå˜é‡ä¸å·¥ä½œç©ºé—´ç®¡ç†</h3>
<p><strong>ROS1 ç¯å¢ƒè®¾ç½®</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>/opt/ros/noetic/setup.bash
<span class="nb">source</span><span class="w"> </span>~/catkin_ws/devel/setup.bash
<span class="c1"># ROS_PACKAGE_PATH è‡ªåŠ¨è®¾ç½®</span>
</code></pre></div>

<p><strong>ROS2 ç¯å¢ƒè®¾ç½®</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>/opt/ros/humble/setup.bash
<span class="nb">source</span><span class="w"> </span>~/ros2_ws/install/setup.bash
<span class="c1"># AMENT_PREFIX_PATH æ›¿ä»£ ROS_PACKAGE_PATH</span>
</code></pre></div>

<p><strong>å·¥ä½œç©ºé—´è¦†ç›–æœºåˆ¶å·®å¼‚</strong>ï¼š</p>
<ul>
<li>ROS1: <code>devel</code> ç©ºé—´è¦†ç›– <code>install</code> ç©ºé—´</li>
<li>ROS2: æ—  <code>devel</code> æ¦‚å¿µï¼Œç›´æ¥ä½¿ç”¨ <code>install</code></li>
<li>ROS2 æ”¯æŒå¤šå·¥ä½œç©ºé—´æ›´åŠ çµæ´»</li>
</ul>
<h2 id="35">3.5 æ¸è¿›å¼è¿ç§»è·¯çº¿å›¾</h2>
<p>æ¸è¿›å¼è¿ç§»æ˜¯å¤§å‹æœºå™¨äººç³»ç»Ÿä» ROS1 è¿‡æ¸¡åˆ° ROS2 çš„æ¨èç­–ç•¥ï¼Œå®ƒå…è®¸åœ¨ä¿æŒç³»ç»Ÿè¿è¡Œçš„åŒæ—¶é€æ­¥å®Œæˆè¿ç§»ã€‚</p>
<h3 id="351">3.5.1 è¿ç§»é˜¶æ®µåˆ’åˆ†</h3>
<p><strong>ç¬¬ä¸€é˜¶æ®µï¼šè¯„ä¼°ä¸å‡†å¤‡ï¼ˆ2-4 å‘¨ï¼‰</strong></p>
<div class="codehilite"><pre><span></span><code>ä»»åŠ¡æ¸…å•ï¼š
â–¡ ä»£ç åº“ä¾èµ–åˆ†æ
â–¡ ç¬¬ä¸‰æ–¹åŒ… ROS2 æ”¯æŒè°ƒç ”
â–¡ æ€§èƒ½åŸºå‡†æµ‹è¯•å»ºç«‹
â–¡ å›¢é˜ŸåŸ¹è®­è®¡åˆ’åˆ¶å®š
â–¡ å¼€å‘ç¯å¢ƒæ­å»ºï¼ˆåŒç‰ˆæœ¬å…±å­˜ï¼‰
</code></pre></div>

<p><strong>ç¬¬äºŒé˜¶æ®µï¼šåŸºç¡€è®¾æ–½è¿ç§»ï¼ˆ4-8 å‘¨ï¼‰</strong></p>
<div class="codehilite"><pre><span></span><code>ä¼˜å…ˆçº§é¡ºåºï¼š

1. æ¶ˆæ¯å’ŒæœåŠ¡å®šä¹‰è¿ç§»
2. æ„å»ºç³»ç»Ÿè¿ç§»ï¼ˆCMake/Colconï¼‰
3. é€šç”¨å·¥å…·åº“è¿ç§»
4. å•å…ƒæµ‹è¯•æ¡†æ¶è¿ç§»
</code></pre></div>

<p><strong>ç¬¬ä¸‰é˜¶æ®µï¼šæ„ŸçŸ¥æ¨¡å—è¿ç§»ï¼ˆ6-12 å‘¨ï¼‰</strong></p>
<div class="codehilite"><pre><span></span><code>è¿ç§»ç­–ç•¥ï¼š

<span class="k">-</span> ä¼ æ„Ÿå™¨é©±åŠ¨èŠ‚ç‚¹ä¼˜å…ˆ
<span class="k">-</span> ä½¿ç”¨ ros1_bridge ä¿æŒæ•°æ®æµ
<span class="k">-</span> é€ä¸ªæ›¿æ¢å¤„ç†èŠ‚ç‚¹
<span class="k">-</span> æ€§èƒ½å¯¹æ¯”éªŒè¯
</code></pre></div>

<p><strong>ç¬¬å››é˜¶æ®µï¼šæ§åˆ¶ä¸è§„åˆ’è¿ç§»ï¼ˆ8-16 å‘¨ï¼‰</strong></p>
<div class="codehilite"><pre><span></span><code>å…³é”®è€ƒè™‘ï¼š

- å®æ—¶æ€§éªŒè¯
- æ§åˆ¶ç¨³å®šæ€§æµ‹è¯•
- æ•…éšœæ³¨å…¥æµ‹è¯•
- å›æ»šæ–¹æ¡ˆå‡†å¤‡
</code></pre></div>

<p><strong>ç¬¬äº”é˜¶æ®µï¼šç³»ç»Ÿé›†æˆä¸ä¼˜åŒ–ï¼ˆ4-8 å‘¨ï¼‰</strong></p>
<div class="codehilite"><pre><span></span><code>æ”¶å°¾å·¥ä½œï¼š

<span class="k">-</span> ç§»é™¤ ros1_bridge
<span class="k">-</span> QoS ç­–ç•¥ä¼˜åŒ–
<span class="k">-</span> ç”Ÿå‘½å‘¨æœŸç®¡ç†å®Œå–„
<span class="k">-</span> æ–‡æ¡£æ›´æ–°
</code></pre></div>

<h3 id="352">3.5.2 æ··åˆç³»ç»Ÿæ¶æ„è®¾è®¡</h3>
<p>åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæ··åˆç³»ç»Ÿæ¶æ„æ˜¯ä¸å¯é¿å…çš„ã€‚åˆç†çš„æ¶æ„è®¾è®¡å¯ä»¥æœ€å°åŒ–æ¡¥æ¥å¼€é”€ï¼š</p>
<div class="codehilite"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  System Monitor                  â”‚
â”‚              (ROS2 Lifecycle Manager)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Perception       â”‚       â”‚    Planning     â”‚
    â”‚   (ROS2 Domain)    â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚  (ROS1 Domain)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜bridge â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              Hardware Abstraction           â”‚
    â”‚                 (ROS2 Native)              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="353">3.5.3 æ•°æ®æµè¿ç§»ç­–ç•¥</h3>
<p><strong>æœ€å°åŒ–æ¡¥æ¥åŸåˆ™</strong>ï¼š</p>
<ol>
<li>è¯†åˆ«é«˜é¢‘æ•°æ®æµï¼Œä¼˜å…ˆè¿ç§»æ•´æ¡ç®¡é“</li>
<li>é¿å…æ•°æ®åœ¨ ROS1 å’Œ ROS2 é—´å¤šæ¬¡å¾€è¿”</li>
<li>ä½¿ç”¨å…±äº«å†…å­˜å‡å°‘å¤§æ•°æ®ï¼ˆå¦‚ç‚¹äº‘ï¼‰ä¼ è¾“å¼€é”€</li>
</ol>
<p><strong>æ•°æ®æµé‡æ„ç¤ºä¾‹</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>åŸå§‹æ¶æ„ (çº¯ ROS1):
Camera â†’ ImageProc â†’ Detection â†’ Tracking â†’ Planning

è¿‡æ¸¡æ¶æ„ (æ··åˆ):
Camera(ROS2) â†’ Bridge â†’ ImageProc(ROS1) â†’ Detection(ROS1) â†’ Bridge â†’ Planning(ROS2)
(æ€§èƒ½æŸå¤±: 2æ¬¡æ¡¥æ¥)

ä¼˜åŒ–æ¶æ„ (æ‰¹é‡è¿ç§»):
Camera(ROS2) â†’ ImageProc(ROS2) â†’ Detection(ROS2) â†’ Bridge â†’ Planning(ROS1)
(æ€§èƒ½æŸå¤±: 1æ¬¡æ¡¥æ¥)
</code></pre></div>

<h3 id="354">3.5.4 å›æ»šä¸å®¹é”™æœºåˆ¶</h3>
<p><strong>ç‰¹æ€§å¼€å…³ï¼ˆFeature Toggleï¼‰</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DualStackNode</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">use_ros2_impl_</span><span class="p">;</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">process</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">use_ros2_impl_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">process_ros2</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">process_ros1_via_bridge</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<p><strong>åŒå†™éªŒè¯ï¼ˆShadow Modeï¼‰</strong>ï¼š</p>
<ul>
<li>æ–°æ—§ç³»ç»Ÿå¹¶è¡Œè¿è¡Œ</li>
<li>ç»“æœå¯¹æ¯”ä½†åªä½¿ç”¨æ—§ç³»ç»Ÿè¾“å‡º</li>
<li>é€æ­¥åˆ‡æ¢åˆ°æ–°ç³»ç»Ÿ</li>
</ul>
<p><strong>ç›‘æ§æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li>æ¶ˆæ¯å»¶è¿Ÿå¯¹æ¯”</li>
<li>CPU/å†…å­˜ä½¿ç”¨ç‡</li>
<li>æ¶ˆæ¯ä¸¢å¤±ç‡</li>
<li>ç³»ç»Ÿç¨³å®šæ€§æŒ‡æ ‡</li>
</ul>
<h2 id="36-toyota-hsr">3.6 äº§ä¸šæ¡ˆä¾‹ç ”ç©¶ï¼šToyota HSR æœºå™¨äººè¿ç§»ç»éªŒ</h2>
<p>Toyota Human Support Robot (HSR) æ˜¯æœåŠ¡æœºå™¨äººé¢†åŸŸçš„æ ‡æ†äº§å“ï¼Œå…¶ä» ROS1 åˆ° ROS2 çš„è¿ç§»è¿‡ç¨‹ä¸ºä¸šç•Œæä¾›äº†å®è´µç»éªŒã€‚</p>
<h3 id="361">3.6.1 é¡¹ç›®èƒŒæ™¯ä¸æŒ‘æˆ˜</h3>
<p><strong>ç³»ç»Ÿè§„æ¨¡</strong>ï¼š</p>
<ul>
<li>èŠ‚ç‚¹æ•°é‡ï¼š120+ ä¸ªæ´»è·ƒèŠ‚ç‚¹</li>
<li>ä»£ç è§„æ¨¡ï¼š50 ä¸‡è¡Œ C++/Python ä»£ç </li>
<li>ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š30+ ä¸ªå¤–éƒ¨åº“</li>
<li>ç¡¬ä»¶æ¥å£ï¼š20+ ç§ä¼ æ„Ÿå™¨å’Œæ‰§è¡Œå™¨</li>
</ul>
<p><strong>è¿ç§»é©±åŠ¨å› ç´ </strong>ï¼š</p>
<ol>
<li><strong>å®æ—¶æ€§éœ€æ±‚</strong>ï¼šæœºæ¢°è‡‚æ§åˆ¶éœ€è¦ 1kHz ç¨³å®šæ§åˆ¶é¢‘ç‡</li>
<li><strong>å®‰å…¨è®¤è¯</strong>ï¼šæ»¡è¶³ ISO 13482 ä¸ªäººæŠ¤ç†æœºå™¨äººå®‰å…¨æ ‡å‡†</li>
<li><strong>å¤šæœºåä½œ</strong>ï¼šæ”¯æŒå¤šå° HSR åœ¨åŒä¸€ç¯å¢ƒä¸­ååŒå·¥ä½œ</li>
<li><strong>äº‘ç«¯é›†æˆ</strong>ï¼šä¸ Toyota æ™ºèƒ½å®¶å±…å¹³å°æ·±åº¦é›†æˆ</li>
</ol>
<h3 id="362">3.6.2 è¿ç§»ç­–ç•¥åˆ¶å®š</h3>
<p>Toyota å›¢é˜Ÿé‡‡ç”¨äº†"æ ¸å¿ƒå…ˆè¡Œï¼Œè¾¹ç¼˜è·Ÿè¿›"çš„ç­–ç•¥ï¼š</p>
<p><strong>ç¬¬ä¸€æ‰¹è¿ç§»ï¼ˆ3ä¸ªæœˆï¼‰</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>ç¡¬ä»¶æŠ½è±¡å±‚ (HAL)
â”œâ”€â”€ ç”µæœºé©±åŠ¨æ¥å£  [å®æ—¶æ€§å…³é”®]
â”œâ”€â”€ IMU/ç¼–ç å™¨æ¥å£ [é«˜é¢‘æ•°æ®]
â””â”€â”€ æ€¥åœç³»ç»Ÿ      [å®‰å…¨å…³é”®]

é€‰æ‹©ç†ç”±ï¼š

- ç›´æ¥å—ç›Šäº ROS2 å®æ—¶æ€§æ”¹è¿›
- å‡å°‘åç»­è¿ç§»çš„æ¥å£å˜æ›´
</code></pre></div>

<p><strong>ç¬¬äºŒæ‰¹è¿ç§»ï¼ˆ6ä¸ªæœˆï¼‰</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>æ„ŸçŸ¥ç®¡é“
â”œâ”€â”€ RGB-D ç›¸æœºé©±åŠ¨
â”œâ”€â”€ ç‚¹äº‘å¤„ç†èŠ‚ç‚¹
â”œâ”€â”€ ç‰©ä½“è¯†åˆ«æœåŠ¡
â””â”€â”€ äººä½“å§¿æ€ä¼°è®¡

ä¼˜åŒ–æˆæœï¼š

- ç‚¹äº‘å¤„ç†å»¶è¿Ÿé™ä½ 40%ï¼ˆé›¶æ‹·è´ä¼ è¾“ï¼‰
- GPU åŠ é€ŸèŠ‚ç‚¹ç›´æ¥é›†æˆ
</code></pre></div>

<p><strong>ç¬¬ä¸‰æ‰¹è¿ç§»ï¼ˆ9ä¸ªæœˆï¼‰</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>ä»»åŠ¡è§„åˆ’ä¸æ‰§è¡Œ
â”œâ”€â”€ è¡Œä¸ºæ ‘æ‰§è¡Œå™¨
â”œâ”€â”€ å¯¼èˆªæ ˆ
â”œâ”€â”€ æœºæ¢°è‡‚è§„åˆ’
â””â”€â”€ æŠ“å–æ§åˆ¶å™¨

æŠ€æœ¯éš¾ç‚¹ï¼š

- MoveIt1 åˆ° MoveIt2 API å¤§å¹…å˜åŒ–
- è‡ªå®šä¹‰è§„åˆ’å™¨æ’ä»¶é‡å†™
</code></pre></div>

<h3 id="363">3.6.3 æŠ€æœ¯äº®ç‚¹ä¸åˆ›æ–°</h3>
<ol>
<li><strong>åŒæ¨¡å¼è¿è¡Œæ¶æ„</strong></li>
</ol>
<p>Toyota å¼€å‘äº†ç‹¬ç‰¹çš„åŒæ¨¡å¼è¿è¡Œæ¶æ„ï¼Œå…è®¸æœºå™¨äººåœ¨ ROS1 å’Œ ROS2 æ¨¡å¼é—´æ— ç¼åˆ‡æ¢ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HSRSystemManager</span><span class="w"> </span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Mode</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ROS1_ONLY</span><span class="p">,</span><span class="w"> </span><span class="n">ROS2_ONLY</span><span class="p">,</span><span class="w"> </span><span class="n">HYBRID</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">Mode</span><span class="w"> </span><span class="n">current_mode_</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">switchMode</span><span class="p">(</span><span class="n">Mode</span><span class="w"> </span><span class="n">target_mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. ä¿å­˜å½“å‰çŠ¶æ€</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">captureSystemState</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 2. ä¼˜é›…åœæ­¢å½“å‰èŠ‚ç‚¹</span>
<span class="w">        </span><span class="n">gracefulShutdown</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 3. æ ¹æ®æ¨¡å¼å¯åŠ¨å¯¹åº”èŠ‚ç‚¹</span>
<span class="w">        </span><span class="k">switch</span><span class="p">(</span><span class="n">target_mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">Mode</span><span class="o">::</span><span class="no">ROS2_ONLY</span><span class="p">:</span>
<span class="w">                </span><span class="n">launchROS2Stack</span><span class="p">();</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">Mode</span><span class="o">::</span><span class="no">HYBRID</span><span class="p">:</span>
<span class="w">                </span><span class="n">launchHybridStack</span><span class="p">();</span>
<span class="w">                </span><span class="n">startBridge</span><span class="p">();</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 4. æ¢å¤ç³»ç»ŸçŠ¶æ€</span>
<span class="w">        </span><span class="n">restoreSystemState</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<ol start="2">
<li><strong>æ€§èƒ½ç›‘æ§ä¸è‡ªåŠ¨é™çº§</strong></li>
</ol>
<p>å®æ—¶æ€§èƒ½ç›‘æ§ç³»ç»Ÿï¼Œå½“æ£€æµ‹åˆ°æ€§èƒ½ä¸‹é™æ—¶è‡ªåŠ¨é™çº§åˆ° ROS1ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PerformanceMonitor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Metrics</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">control_loop_jitter_ms</span><span class="p">;</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">message_latency_ms</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">dropped_messages</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">monitoringLoop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Metrics</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">collectMetrics</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">control_loop_jitter_ms</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">2.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// è¶…è¿‡ 2ms æŠ–åŠ¨</span>
<span class="w">            </span><span class="n">RCLCPP_WARN</span><span class="p">(</span><span class="n">logger_</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Control jitter detected: %.2fms&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                        </span><span class="n">m</span><span class="p">.</span><span class="n">control_loop_jitter_ms</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">consecutive_violations_</span><span class="o">++</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">triggerFallback</span><span class="p">();</span><span class="w">  </span><span class="c1">// é™çº§åˆ° ROS1</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<ol start="3">
<li><strong>æ¶ˆæ¯è½¬æ¢ä¼˜åŒ–</strong></li>
</ol>
<p>é’ˆå¯¹é«˜é¢‘æ¶ˆæ¯ï¼ˆå¦‚å…³èŠ‚çŠ¶æ€ï¼‰çš„é›¶æ‹·è´æ¡¥æ¥å®ç°ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ä½¿ç”¨å…±äº«å†…å­˜é¿å…åºåˆ—åŒ–å¼€é”€</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ZeroCopyBridge</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">SharedJointState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">        </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">TypeAdapter</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">JointState</span><span class="p">,</span>
<span class="w">                           </span><span class="n">SharedMemoryJointState</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">bridgeJointStates</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ROS1 ç«¯ç›´æ¥å†™å…¥å…±äº«å†…å­˜</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">shm_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shm_allocator_</span><span class="p">.</span><span class="n">allocate</span><span class="p">();</span>
<span class="w">        </span><span class="n">fillJointState</span><span class="p">(</span><span class="n">shm_msg</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// ROS2 ç«¯é›¶æ‹·è´å‘å¸ƒ</span>
<span class="w">        </span><span class="n">ros2_pub_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">shm_msg</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="364">3.6.4 è¿ç§»è¿‡ç¨‹ä¸­çš„å…³é”®å†³ç­–</h3>
<p><strong>å†³ç­–1ï¼šè‡ªå®šä¹‰ DDS é…ç½®</strong></p>
<div class="codehilite"><pre><span></span><code><span class="cm">&lt;!-- Toyota HSR DDS é…ç½®ä¼˜åŒ– --&gt;</span>
<span class="nt">&lt;profiles&gt;</span>
<span class="w">  </span><span class="nt">&lt;participant</span><span class="w"> </span><span class="na">profile_name=</span><span class="s">&quot;hsr_participant&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;rtps&gt;</span>
<span class="w">      </span><span class="nt">&lt;builtin&gt;</span>
<span class="w">        </span><span class="nt">&lt;discovery_config&gt;</span>
<span class="w">          </span><span class="nt">&lt;leaseDuration&gt;</span>
<span class="w">            </span><span class="nt">&lt;sec&gt;</span>10<span class="nt">&lt;/sec&gt;</span><span class="w">  </span><span class="cm">&lt;!-- å¿«é€Ÿæ•…éšœæ£€æµ‹ --&gt;</span>
<span class="w">          </span><span class="nt">&lt;/leaseDuration&gt;</span>
<span class="w">        </span><span class="nt">&lt;/discovery_config&gt;</span>
<span class="w">      </span><span class="nt">&lt;/builtin&gt;</span>
<span class="w">      </span><span class="nt">&lt;resources&gt;</span>
<span class="w">        </span><span class="nt">&lt;max_msg_size&gt;</span>10485760<span class="nt">&lt;/max_msg_size&gt;</span><span class="w">  </span><span class="cm">&lt;!-- 10MB for point clouds --&gt;</span>
<span class="w">      </span><span class="nt">&lt;/resources&gt;</span>
<span class="w">    </span><span class="nt">&lt;/rtps&gt;</span>
<span class="w">  </span><span class="nt">&lt;/participant&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>
</code></pre></div>

<p><strong>å†³ç­–2ï¼šç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹æ ‡å‡†åŒ–</strong></p>
<p>æ‰€æœ‰å…³é”®èŠ‚ç‚¹ç»Ÿä¸€å®ç°ç”Ÿå‘½å‘¨æœŸæ¥å£ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HSRLifecycleNode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">rclcpp_lifecycle</span><span class="o">::</span><span class="n">LifecycleNode</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ ‡å‡†åŒ–çš„çŠ¶æ€è½¬æ¢</span>
<span class="w">    </span><span class="n">CallbackReturn</span><span class="w"> </span><span class="nf">on_configure</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">State</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// åŠ è½½å‚æ•°ï¼Œåˆ†é…èµ„æº</span>
<span class="w">        </span><span class="n">loadParameters</span><span class="p">();</span>
<span class="w">        </span><span class="n">allocateResources</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CallbackReturn</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">CallbackReturn</span><span class="w"> </span><span class="nf">on_activate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">State</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// å¯åŠ¨ç¡¬ä»¶ï¼Œå¼€å§‹å‘å¸ƒ</span>
<span class="w">        </span><span class="n">startHardware</span><span class="p">();</span>
<span class="w">        </span><span class="n">startPublishers</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CallbackReturn</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="365">3.6.5 æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–æˆæœ</h3>
<p>| æŒ‡æ ‡ | ROS1 åŸºçº¿ | ROS2 ä¼˜åŒ–å | æ”¹è¿›å¹…åº¦ |</p>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>ROS1 åŸºçº¿</th>
<th>ROS2 ä¼˜åŒ–å</th>
<th>æ”¹è¿›å¹…åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ§åˆ¶å¾ªç¯é¢‘ç‡</td>
<td>500 Hz (Â±50Hz)</td>
<td>1000 Hz (Â±10Hz)</td>
<td>100% â†‘</td>
</tr>
<tr>
<td>ç‚¹äº‘ä¼ è¾“å»¶è¿Ÿ</td>
<td>45ms</td>
<td>12ms</td>
<td>73% â†“</td>
</tr>
<tr>
<td>ç³»ç»Ÿå¯åŠ¨æ—¶é—´</td>
<td>120s</td>
<td>35s</td>
<td>71% â†“</td>
</tr>
<tr>
<td>å†…å­˜å ç”¨</td>
<td>4.2 GB</td>
<td>3.1 GB</td>
<td>26% â†“</td>
</tr>
<tr>
<td>CPU ä½¿ç”¨ç‡ï¼ˆç©ºé—²ï¼‰</td>
<td>35%</td>
<td>22%</td>
<td>37% â†“</td>
</tr>
<tr>
<td>ç½‘ç»œå¸¦å®½ï¼ˆå±€åŸŸç½‘ï¼‰</td>
<td>850 Mbps</td>
<td>320 Mbps</td>
<td>62% â†“</td>
</tr>
</tbody>
</table>
<h3 id="366">3.6.6 ç»éªŒæ•™è®­ä¸å»ºè®®</h3>
<p><strong>æˆåŠŸå› ç´ </strong>ï¼š</p>
<ol>
<li><strong>å……åˆ†çš„æµ‹è¯•è¦†ç›–</strong>ï¼šè¿ç§»å‰æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 85%</li>
<li><strong>æ¸è¿›å¼è¿ç§»</strong>ï¼šé¿å…"å¤§çˆ†ç‚¸"å¼çš„ä¸€æ¬¡æ€§è¿ç§»</li>
<li><strong>æ€§èƒ½åŸºå‡†å…ˆè¡Œ</strong>ï¼šå»ºç«‹è¯¦ç»†çš„æ€§èƒ½åŸºå‡†ç”¨äºå¯¹æ¯”</li>
<li><strong>å›¢é˜ŸåŸ¹è®­æŠ•å…¥</strong>ï¼šæå‰ 3 ä¸ªæœˆå¼€å§‹ ROS2 åŸ¹è®­</li>
</ol>
<p><strong>è¸©å‘ç»å†</strong>ï¼š</p>
<ol>
<li><strong>QoS ä¸åŒ¹é…</strong>ï¼šæ—©æœŸå›  QoS é…ç½®ä¸å½“å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±</li>
<li><strong>æ—¶é—´åŒæ­¥é—®é¢˜</strong>ï¼šå¤šæœºç³»ç»Ÿæ—¶é’ŸåŒæ­¥é…ç½®å¤æ‚</li>
<li><strong>æ„å»ºæ—¶é—´å¢é•¿</strong>ï¼šåˆæœŸ colcon æ„å»ºæ—¶é—´æ˜¯ catkin çš„ 2 å€</li>
<li><strong>æ–‡æ¡£æ»å</strong>ï¼šéƒ¨åˆ† ROS2 ç‰¹æ€§æ–‡æ¡£ä¸å®Œå–„</li>
</ol>
<h2 id="37">3.7 é«˜çº§è¯é¢˜ï¼šé›¶åœæœºè¿ç§»ä¸ç°åº¦å‘å¸ƒç­–ç•¥</h2>
<p>å¯¹äº 24/7 è¿è¡Œçš„ç”Ÿäº§ç³»ç»Ÿï¼Œé›¶åœæœºè¿ç§»æ˜¯å¿…é¡»è€ƒè™‘çš„é«˜çº§è¯é¢˜ã€‚æœ¬èŠ‚ä»‹ç»å·¥ä¸šçº§çš„è¿ç§»ç­–ç•¥ã€‚</p>
<h3 id="371">3.7.1 è“ç»¿éƒ¨ç½²æ¶æ„</h3>
<p>è“ç»¿éƒ¨ç½²å…è®¸åœ¨ä¸¤ä¸ªå®Œæ•´çš„ç³»ç»Ÿå®ä¾‹é—´åˆ‡æ¢ï¼š</p>
<div class="codehilite"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Load Balancer / Router           â”‚
â”‚         (Topic-based Traffic Control)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚     70%     â”‚    30%
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   Blue System    â”‚   â”‚  Green System  â”‚
     â”‚   (ROS1 Stable)  â”‚   â”‚  (ROS2 Testing)â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                    â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         Shared Hardware Layer          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="372">3.7.2 é‡‘ä¸é›€å‘å¸ƒå®ç°</h3>
<p>é€æ­¥å°†æµé‡ä» ROS1 åˆ‡æ¢åˆ° ROS2ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CanaryDeployment</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ros1_weight</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ros2_weight</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">gradual_rollout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_ros2_weight</span><span class="p">,</span> <span class="n">duration_hours</span><span class="p">):</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration_hours</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># æ¯åˆ†é’Ÿè°ƒæ•´ä¸€æ¬¡</span>
        <span class="n">increment</span> <span class="o">=</span> <span class="n">target_ros2_weight</span> <span class="o">/</span> <span class="n">steps</span>

        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ros2_weight</span> <span class="o">+=</span> <span class="n">increment</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ros1_weight</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ros2_weight</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_routing_weights</span><span class="p">()</span>

            <span class="c1"># ç›‘æ§å…³é”®æŒ‡æ ‡</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_anomaly</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
                <span class="k">break</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>  <span class="c1"># ç­‰å¾…1åˆ†é’Ÿ</span>
</code></pre></div>

<h3 id="373">3.7.3 æµé‡é•œåƒä¸éªŒè¯</h3>
<p>å°†ç”Ÿäº§æµé‡é•œåƒåˆ° ROS2 ç³»ç»Ÿè¿›è¡ŒéªŒè¯ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TrafficMirror</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleMessage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MessageType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. æ­£å¸¸å¤„ç†ï¼ˆROS1ï¼‰</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">result_ros1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ros1_processor_</span><span class="o">-&gt;</span><span class="n">process</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="w">        </span><span class="n">sendResponse</span><span class="p">(</span><span class="n">result_ros1</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 2. å¼‚æ­¥é•œåƒåˆ° ROS2</span>
<span class="w">        </span><span class="n">async_queue_</span><span class="p">.</span><span class="n">push</span><span class="p">([</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">result_ros2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ros2_processor_</span><span class="o">-&gt;</span><span class="n">process</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// 3. ç»“æœå¯¹æ¯”</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">compareResults</span><span class="p">(</span><span class="n">result_ros1</span><span class="p">,</span><span class="w"> </span><span class="n">result_ros2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">logDiscrepancy</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">result_ros1</span><span class="p">,</span><span class="w"> </span><span class="n">result_ros2</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="374">3.7.4 çŠ¶æ€åŒæ­¥æœºåˆ¶</h3>
<p>ç¡®ä¿åˆ‡æ¢æ—¶ç³»ç»ŸçŠ¶æ€ä¸€è‡´æ€§ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StateSynchronizer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">SystemState</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="o">&gt;</span><span class="w"> </span><span class="n">robot_poses</span><span class="p">;</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">JointState</span><span class="o">&gt;</span><span class="w"> </span><span class="n">joint_states</span><span class="p">;</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">OccupancyGrid</span><span class="o">&gt;</span><span class="w"> </span><span class="n">maps</span><span class="p">;</span>
<span class="w">        </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="w"> </span><span class="n">timestamp</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="n">SystemState</span><span class="w"> </span><span class="nf">captureState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SystemState</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
<span class="w">        </span><span class="n">state</span><span class="p">.</span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// åŸå­æ€§åœ°æ•è·æ‰€æœ‰çŠ¶æ€</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">state_mutex_</span><span class="p">);</span>
<span class="w">        </span><span class="n">state</span><span class="p">.</span><span class="n">robot_poses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_poses_</span><span class="p">;</span>
<span class="w">        </span><span class="n">state</span><span class="p">.</span><span class="n">joint_states</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_joints_</span><span class="p">;</span>
<span class="w">        </span><span class="n">state</span><span class="p">.</span><span class="n">maps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_maps_</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">restoreState</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SystemState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// æ¢å¤åˆ° ROS2 ç³»ç»Ÿ</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">pose</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">robot_poses</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ros2_pose_pubs_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">pose</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// ... æ¢å¤å…¶ä»–çŠ¶æ€</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="375">3.7.5 å›æ»šç­–ç•¥ä¸æ–­è·¯å™¨</h3>
<p>è‡ªåŠ¨æ£€æµ‹é—®é¢˜å¹¶å›æ»šï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CircuitBreaker</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CLOSED</span><span class="p">,</span><span class="w"> </span><span class="n">OPEN</span><span class="p">,</span><span class="w"> </span><span class="n">HALF_OPEN</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="n">State</span><span class="w"> </span><span class="n">state_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">State</span><span class="o">::</span><span class="n">CLOSED</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">failure_count_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">failure_threshold_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">shouldProcess</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state_</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">State</span><span class="o">::</span><span class="n">OPEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cooldown_expired</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">state_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">State</span><span class="o">::</span><span class="n">HALF_OPEN</span><span class="p">;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">  </span><span class="c1">// å°è¯•æ¢å¤</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// ç†”æ–­ä¸­</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordSuccess</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">failure_count_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">state_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">State</span><span class="o">::</span><span class="n">CLOSED</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordFailure</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">failure_count_</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">failure_count_</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">failure_threshold_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">state_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">State</span><span class="o">::</span><span class="n">OPEN</span><span class="p">;</span>
<span class="w">            </span><span class="n">triggerRollback</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<h2 id="38">3.8 æœ¬ç« å°ç»“</h2>
<p>æœ¬ç« ç³»ç»Ÿä»‹ç»äº†ä» ROS1 è¿ç§»åˆ° ROS2 çš„å®Œæ•´ç­–ç•¥å’Œå®è·µæ–¹æ³•ã€‚å…³é”®è¦ç‚¹åŒ…æ‹¬ï¼š</p>
<h3 id="_1">æ ¸å¿ƒæ¦‚å¿µå›é¡¾</h3>
<ol>
<li>
<p><strong>è¿ç§»å†³ç­–æ¡†æ¶</strong>ï¼šåŸºäºç³»ç»Ÿå¤æ‚åº¦ã€å®æ—¶æ€§éœ€æ±‚ã€å®‰å…¨è¦æ±‚ç­‰å¤šç»´åº¦è¯„ä¼°è¿ç§»å¿…è¦æ€§å’Œå¯è¡Œæ€§</p>
</li>
<li>
<p><strong>æ¡¥æ¥æŠ€æœ¯</strong>ï¼šros1_bridge æä¾›äº†æ¸è¿›å¼è¿ç§»çš„æŠ€æœ¯åŸºç¡€ï¼Œæ”¯æŒåŠ¨æ€å’Œé™æ€ä¸¤ç§æ¨¡å¼ï¼Œæ€§èƒ½å¼€é”€å¯æ§</p>
</li>
<li>
<p><strong>API è¿ç§»æ¨¡å¼</strong>ï¼š
   - ä»å‡½æ•°å¼åˆ°é¢å‘å¯¹è±¡çš„ç¼–ç¨‹èŒƒå¼è½¬å˜
   - æ›´ä¸¥æ ¼çš„ç±»å‹ç³»ç»Ÿå’Œå‚æ•°ç®¡ç†
   - ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„æ ‡å‡†åŒ–</p>
</li>
<li>
<p><strong>æ„å»ºç³»ç»Ÿå·®å¼‚</strong>ï¼š
   - Catkin â†’ Colcon çš„å·¥å…·é“¾è¿ç§»
   - æ›´çµæ´»çš„å·¥ä½œç©ºé—´ç®¡ç†
   - å¹¶è¡Œæ„å»ºèƒ½åŠ›çš„æå‡</p>
</li>
</ol>
<h3 id="_2">å…³é”®æŠ€æœ¯å…¬å¼</h3>
<p><strong>è¿ç§»é£é™©è¯„ä¼°</strong>ï¼š
$$R_{migration} = \alpha \cdot C_{complexity} + \beta \cdot T_{downtime} + \gamma \cdot S_{skills}$$
å…¶ä¸­ï¼š</p>
<ul>
<li>$C_{complexity}$ï¼šç³»ç»Ÿå¤æ‚åº¦ï¼ˆ0-1æ ‡å‡†åŒ–ï¼‰</li>
<li>$T_{downtime}$ï¼šå¯æ¥å—åœæœºæ—¶é—´çš„å€’æ•°</li>
<li>$S_{skills}$ï¼šå›¢é˜ŸæŠ€èƒ½å·®è·ç³»æ•°</li>
<li>$\alpha, \beta, \gamma$ï¼šæƒé‡å› å­</li>
</ul>
<p><strong>æ€§èƒ½æ”¹è¿›é¢„æœŸ</strong>ï¼š
$$P_{improvement} = \frac{L_{ROS1} - L_{ROS2}}{L_{ROS1}} \times 100\%$$</p>
<p>å…¶ä¸­ $L$ ä»£è¡¨å»¶è¿ŸæŒ‡æ ‡</p>
<h3 id="_3">å®è·µç»éªŒæ€»ç»“</h3>
<ol>
<li><strong>æ¸è¿›å¼è¿ç§»ä¼˜äºå¤§çˆ†ç‚¸å¼è¿ç§»</strong>ï¼šé™ä½é£é™©ï¼Œå…è®¸é€æ­¥éªŒè¯</li>
<li><strong>æ€§èƒ½åŸºå‡†å…ˆè¡Œ</strong>ï¼šå»ºç«‹é‡åŒ–å¯¹æ¯”åŸºç¡€</li>
<li><strong>åŒæ¨¡å¼è¿è¡Œæ¶æ„</strong>ï¼šæä¾›å›æ»šèƒ½åŠ›å’Œ A/B æµ‹è¯•ç¯å¢ƒ</li>
<li><strong>è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–</strong>ï¼šç¡®ä¿è¿ç§»è´¨é‡</li>
</ol>
<h3 id="_4">è¿ç§»æ—¶é—´çº¿å‚è€ƒ</h3>
<ul>
<li>å°å‹ç³»ç»Ÿï¼ˆ&lt;20èŠ‚ç‚¹ï¼‰ï¼š2-3ä¸ªæœˆ</li>
<li>ä¸­å‹ç³»ç»Ÿï¼ˆ20-100èŠ‚ç‚¹ï¼‰ï¼š6-9ä¸ªæœˆ  </li>
<li>å¤§å‹ç³»ç»Ÿï¼ˆ&gt;100èŠ‚ç‚¹ï¼‰ï¼š12-18ä¸ªæœˆ</li>
</ul>
<h2 id="39">3.9 ç»ƒä¹ é¢˜</h2>
<h3 id="_5">åŸºç¡€ç†è§£é¢˜</h3>
<p><strong>ç»ƒä¹  3.1</strong>ï¼šè§£é‡Š ros1_bridge çš„å·¥ä½œåŸç†ï¼Œå¹¶è¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯ç±»å‹æ˜ å°„ã€‚</p>
<details>
<summary>æç¤º</summary>
<p>è€ƒè™‘ ROS1 å’Œ ROS2 çš„æ¶ˆæ¯åºåˆ—åŒ–æ ¼å¼å·®å¼‚ï¼Œä»¥åŠ DDS ä¸ TCPROS çš„åè®®å·®å¼‚ã€‚</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>ros1_bridge æ˜¯ä¸€ä¸ªåŒæ ˆèŠ‚ç‚¹ï¼ŒåŒæ—¶è¿è¡Œ ROS1 å’Œ ROS2 å®¢æˆ·ç«¯åº“ã€‚å®ƒè®¢é˜…ä¸€ä¾§çš„æ¶ˆæ¯ï¼Œè¿›è¡Œååºåˆ—åŒ–ï¼Œè½¬æ¢æ•°æ®æ ¼å¼ï¼Œå†åºåˆ—åŒ–å¹¶å‘å¸ƒåˆ°å¦ä¸€ä¾§ã€‚æ¶ˆæ¯ç±»å‹æ˜ å°„æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºï¼š1) ROS2 æ¶ˆæ¯ä½¿ç”¨ IDL å®šä¹‰ï¼Œå‘½åç©ºé—´ä¸åŒï¼›2) æŸäº›å­—æ®µç±»å‹å‘ç”Ÿå˜åŒ–ï¼ˆå¦‚æ—¶é—´æˆ³ï¼‰ï¼›3) ROS2 æ”¯æŒæ›´ä¸°å¯Œçš„ç±»å‹ç³»ç»Ÿã€‚</p>
</details>
<p><strong>ç»ƒä¹  3.2</strong>ï¼šåˆ—ä¸¾ä¸‰ä¸ª ROS2 ç›¸æ¯” ROS1 åœ¨ API å±‚é¢çš„ä¸»è¦æ”¹è¿›ã€‚</p>
<details>
<summary>æç¤º</summary>
<p>è€ƒè™‘ç±»å‹å®‰å…¨ã€èµ„æºç®¡ç†å’Œå¹¶å‘æ§åˆ¶æ–¹é¢ã€‚</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>1) å¼ºç±»å‹æ¨¡æ¿åŒ–æ¥å£ï¼šPublisher<MessageType> ç¡®ä¿ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼›2) RAII èµ„æºç®¡ç†ï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼›3) æ‰§è¡Œå™¨æ¨¡å‹ï¼šæä¾›æ›´çµæ´»çš„å›è°ƒè°ƒåº¦å’Œå¹¶å‘æ§åˆ¶ã€‚</p>
</details>
<p><strong>ç»ƒä¹  3.3</strong>ï¼šæ¯”è¾ƒ catkin_make å’Œ colcon build çš„æ„å»ºç­–ç•¥å·®å¼‚ã€‚</p>
<details>
<summary>æç¤º</summary>
<p>æ€è€ƒæ„å»ºéš”ç¦»ã€å¹¶è¡Œåº¦å’Œå¢é‡æ„å»ºæ–¹é¢ã€‚</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>catkin_make ä½¿ç”¨å•ä¸€ CMake ä¸Šä¸‹æ–‡ï¼Œæ‰€æœ‰åŒ…å…±äº«æ„å»ºç©ºé—´ï¼Œä¾èµ–å…³ç³»ç´§å¯†è€¦åˆã€‚colcon build ä¸ºæ¯ä¸ªåŒ…ç‹¬ç«‹æ„å»ºï¼Œæä¾›æ›´å¥½çš„éš”ç¦»æ€§å’Œå¹¶è¡Œåº¦ï¼Œæ”¯æŒå¢é‡æ„å»ºå’Œå¤šç§æ„å»ºç³»ç»Ÿã€‚</p>
</details>
<h3 id="_6">å®è·µåº”ç”¨é¢˜</h3>
<p><strong>ç»ƒä¹  3.4</strong>ï¼šè®¾è®¡ä¸€ä¸ªæ··åˆç³»ç»Ÿæ¶æ„ï¼Œå…¶ä¸­æ„ŸçŸ¥æ¨¡å—ä½¿ç”¨ ROS2ï¼Œè€Œè§„åˆ’æ¨¡å—ä»ä½¿ç”¨ ROS1ã€‚ç”»å‡ºæ¶æ„å›¾å¹¶æ ‡æ³¨å…³é”®æ•°æ®æµã€‚</p>
<details>
<summary>æç¤º</summary>
<p>è€ƒè™‘å“ªäº›æ•°æ®éœ€è¦é€šè¿‡ bridgeï¼Œå¦‚ä½•æœ€å°åŒ–æ¡¥æ¥å¼€é”€ã€‚</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>æ¶æ„åº”å°†é«˜é¢‘ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆæ¿€å…‰ã€ç›¸æœºï¼‰åœ¨ ROS2 åŸŸå†…å¤„ç†å®Œæˆï¼Œä»…å°†å¤„ç†åçš„æ„ŸçŸ¥ç»“æœï¼ˆå¦‚éšœç¢ç‰©åˆ—è¡¨ã€è¯­ä¹‰åœ°å›¾ï¼‰é€šè¿‡ bridge ä¼ é€’ç»™ ROS1 è§„åˆ’æ¨¡å—ã€‚è¿™æ ·å¯ä»¥é¿å…åŸå§‹ä¼ æ„Ÿå™¨æ•°æ®çš„é¢‘ç¹æ¡¥æ¥ï¼Œé™ä½å»¶è¿Ÿå’Œå¸¦å®½å¼€é”€ã€‚</p>
</details>
<p><strong>ç»ƒä¹  3.5</strong>ï¼šç¼–å†™ä¸€ä¸ª Python è„šæœ¬ï¼Œè‡ªåŠ¨åˆ†æ ROS1 åŒ…çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ç”Ÿæˆè¿ç§»ä¼˜å…ˆçº§åˆ—è¡¨ã€‚</p>
<details>
<summary>æç¤º</summary>
<p>ä½¿ç”¨ rospack æˆ–è§£æ package.xmlï¼Œæ„å»ºä¾èµ–å›¾ï¼Œè¿›è¡Œæ‹“æ‰‘æ’åºã€‚</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>è„šæœ¬åº”ï¼š1) é€’å½’è§£ææ‰€æœ‰ package.xml æ–‡ä»¶ï¼›2) æ„å»ºæœ‰å‘æ— ç¯å›¾è¡¨ç¤ºä¾èµ–å…³ç³»ï¼›3) è¯†åˆ«å¶èŠ‚ç‚¹ï¼ˆæ— å…¶ä»–åŒ…ä¾èµ–çš„åŒ…ï¼‰ä½œä¸ºä¼˜å…ˆè¿ç§»ç›®æ ‡ï¼›4) ä½¿ç”¨æ‹“æ‰‘æ’åºç”Ÿæˆè¿ç§»é¡ºåºï¼Œç¡®ä¿ä¾èµ–åŒ…å…ˆäºè¢«ä¾èµ–åŒ…è¿ç§»ã€‚</p>
</details>
<h3 id="_7">å¼€æ”¾æ€è€ƒé¢˜</h3>
<p><strong>ç»ƒä¹  3.6</strong>ï¼šæŸå…¬å¸çš„ç‰©æµæœºå™¨äººç³»ç»Ÿæœ‰ 50 ä¸ª ROS1 èŠ‚ç‚¹ï¼Œéœ€è¦åœ¨ä¸å½±å“æ—¥å¸¸è¿è¥çš„æƒ…å†µä¸‹è¿ç§»åˆ° ROS2ã€‚è¯·è®¾è®¡ä¸€ä¸ªä¸ºæœŸ 6 ä¸ªæœˆçš„è¿ç§»è®¡åˆ’ï¼ŒåŒ…æ‹¬é‡Œç¨‹ç¢‘ã€é£é™©ç‚¹å’ŒéªŒè¯ç­–ç•¥ã€‚</p>
<details>
<summary>æç¤º</summary>
<p>è€ƒè™‘ä¸šåŠ¡ä¼˜å…ˆçº§ã€æŠ€æœ¯ä¾èµ–ã€å›¢é˜Ÿèƒ½åŠ›å»ºè®¾å’Œå›æ»šæ–¹æ¡ˆã€‚</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>æœˆ1-2ï¼šç¯å¢ƒå‡†å¤‡ï¼Œå›¢é˜ŸåŸ¹è®­ï¼Œå»ºç«‹æ€§èƒ½åŸºå‡†ï¼Œè¿ç§»åŸºç¡€åº“å’Œæ¶ˆæ¯å®šä¹‰ã€‚æœˆ3ï¼šè¿ç§»ç¡¬ä»¶æŠ½è±¡å±‚å’Œä¼ æ„Ÿå™¨é©±åŠ¨ï¼Œä½¿ç”¨ bridge ä¿æŒä¸Šå±‚å…¼å®¹ã€‚æœˆ4ï¼šè¿ç§»å®šä½å’Œå»ºå›¾æ¨¡å—ï¼Œshadow mode éªŒè¯ã€‚æœˆ5ï¼šè¿ç§»å¯¼èˆªå’Œè§„åˆ’æ¨¡å—ï¼ŒA/B æµ‹è¯•ã€‚æœˆ6ï¼šç³»ç»Ÿä¼˜åŒ–ï¼Œç§»é™¤ bridgeï¼Œæ–‡æ¡£å®Œå–„ã€‚å…³é”®é£é™©ç‚¹ï¼šç¬¬ä¸‰æ–¹åº“å…¼å®¹æ€§ã€å®æ—¶æ€§èƒ½é€€åŒ–ã€å›¢é˜Ÿå­¦ä¹ æ›²çº¿ã€‚éªŒè¯ç­–ç•¥ï¼šæ¯é˜¶æ®µè®¾ç½®é‡åŒ–æŒ‡æ ‡ï¼Œä¿æŒåŒç³»ç»Ÿå¹¶è¡Œè¿è¡Œèƒ½åŠ›ã€‚</p>
</details>
<p><strong>ç»ƒä¹  3.7</strong>ï¼šè®¨è®ºåœ¨äº‘æœºå™¨äººåœºæ™¯ä¸‹ï¼ŒROS1 åˆ° ROS2 è¿ç§»å¯èƒ½å¸¦æ¥çš„é¢å¤–æŒ‘æˆ˜å’Œæœºé‡ã€‚</p>
<details>
<summary>æç¤º</summary>
<p>è€ƒè™‘ DDS çš„å‘ç°æœºåˆ¶ã€å®‰å…¨æ€§ã€QoS ç­–ç•¥åœ¨å¹¿åŸŸç½‘ç¯å¢ƒä¸‹çš„è¡¨ç°ã€‚</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>æŒ‘æˆ˜ï¼š1) DDS å‘ç°æœºåˆ¶åœ¨ NAT å’Œé˜²ç«å¢™ç¯å¢ƒä¸‹é…ç½®å¤æ‚ï¼›2) ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…å¯¹ QoS ç­–ç•¥çš„å½±å“ï¼›3) å¤§è§„æ¨¡éƒ¨ç½²æ—¶çš„åŸŸç®¡ç†ã€‚æœºé‡ï¼š1) DDS å®‰å…¨æ‰©å±•æä¾›ç«¯åˆ°ç«¯åŠ å¯†ï¼›2) QoS ç­–ç•¥æ”¯æŒæ›´å¥½çš„ç½‘ç»œé€‚åº”æ€§ï¼›3) å»ä¸­å¿ƒåŒ–æ¶æ„æ›´é€‚åˆè¾¹ç¼˜è®¡ç®—ï¼›4) æ”¯æŒå¤šç§ DDS å®ç°ï¼Œå¯é€‰æ‹©äº‘ä¼˜åŒ–ç‰ˆæœ¬ã€‚</p>
</details>
<p><strong>ç»ƒä¹  3.8</strong>ï¼šè¯„ä¼°ä½¿ç”¨å®¹å™¨åŒ–ï¼ˆDocker/Kubernetesï¼‰æŠ€æœ¯è¾…åŠ© ROS1 åˆ° ROS2 è¿ç§»çš„å¯è¡Œæ€§ã€‚è®¾è®¡ä¸€ä¸ªåŸºäºå®¹å™¨çš„è¿ç§»æ–¹æ¡ˆã€‚</p>
<details>
<summary>æç¤º</summary>
<p>è€ƒè™‘å®¹å™¨éš”ç¦»ã€ç½‘ç»œé…ç½®ã€ç¡¬ä»¶è®¿é—®å’Œç¼–æ’ç­–ç•¥ã€‚</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>å®¹å™¨åŒ–æ–¹æ¡ˆï¼š1) å°† ROS1 å’Œ ROS2 èŠ‚ç‚¹åˆ†åˆ«æ‰“åŒ…åˆ°ä¸åŒå®¹å™¨ï¼›2) ä½¿ç”¨ host ç½‘ç»œæ¨¡å¼ç¡®ä¿ DDS å‘ç°ï¼›3) é€šè¿‡ Kubernetes Service ç®¡ç†æœåŠ¡å‘ç°ï¼›4) ä½¿ç”¨ ConfigMap ç®¡ç†é…ç½®ï¼Œæ”¯æŒå¿«é€Ÿåˆ‡æ¢ï¼›5) é€šè¿‡ Rolling Update å®ç°æ¸è¿›å¼éƒ¨ç½²ã€‚ä¼˜åŠ¿ï¼šç¯å¢ƒéš”ç¦»ã€å¿«é€Ÿå›æ»šã€èµ„æºæ§åˆ¶ã€‚æŒ‘æˆ˜ï¼šç¡¬ä»¶è®¾å¤‡è®¿é—®ã€å®æ—¶æ€§èƒ½å¼€é”€ã€ç½‘ç»œé…ç½®å¤æ‚æ€§ã€‚</p>
</details>
<h2 id="310">3.10 å¸¸è§é™·é˜±ä¸é”™è¯¯</h2>
<h3 id="1-qos">é™·é˜± 1ï¼šå¿½è§† QoS å…¼å®¹æ€§</h3>
<p><strong>é—®é¢˜</strong>ï¼šROS2 èŠ‚ç‚¹é—´ QoS è®¾ç½®ä¸åŒ¹é…å¯¼è‡´æ— æ³•é€šä¿¡
<strong>ç—‡çŠ¶</strong>ï¼šèŠ‚ç‚¹å¯åŠ¨æ­£å¸¸ä½†æ”¶ä¸åˆ°æ¶ˆæ¯
<strong>è§£å†³</strong>ï¼šä½¿ç”¨ <code>ros2 topic info -v</code> æŸ¥çœ‹ QoS è®¾ç½®ï¼Œç¡®ä¿å‘å¸ƒè€…å’Œè®¢é˜…è€…å…¼å®¹</p>
<h3 id="2">é™·é˜± 2ï¼šæ—¶é—´æºæ··æ·†</h3>
<p><strong>é—®é¢˜</strong>ï¼šROS1 ä½¿ç”¨ <code>/clock</code> è¯é¢˜ï¼ŒROS2 ä½¿ç”¨å‚æ•° <code>use_sim_time</code>
<strong>ç—‡çŠ¶</strong>ï¼šä»¿çœŸæ—¶é—´å’Œç³»ç»Ÿæ—¶é—´ä¸ä¸€è‡´
<strong>è§£å†³</strong>ï¼šç»Ÿä¸€é…ç½®æ—¶é—´æºï¼Œbridge éœ€è¦ç‰¹æ®Šå¤„ç†æ—¶é—´åŒæ­¥</p>
<h3 id="3">é™·é˜± 3ï¼šå‚æ•°æœåŠ¡æ¶æ„å·®å¼‚</h3>
<p><strong>é—®é¢˜</strong>ï¼šROS1 å…¨å±€å‚æ•°æœåŠ¡å™¨ï¼ŒROS2 èŠ‚ç‚¹æœ¬åœ°å‚æ•°
<strong>ç—‡çŠ¶</strong>ï¼šå‚æ•°æ— æ³•è·¨èŠ‚ç‚¹å…±äº«
<strong>è§£å†³</strong>ï¼šä½¿ç”¨å‚æ•°äº‹ä»¶æœºåˆ¶æˆ–ä¸“é—¨çš„å‚æ•°ç®¡ç†èŠ‚ç‚¹</p>
<h3 id="4">é™·é˜± 4ï¼šæ¶ˆæ¯å®šä¹‰ä¸å…¼å®¹</h3>
<p><strong>é—®é¢˜</strong>ï¼šç›¸åŒåç§°çš„æ¶ˆæ¯åœ¨ ROS1 å’Œ ROS2 ä¸­å­—æ®µä¸åŒ
<strong>ç—‡çŠ¶</strong>ï¼šbridge æŠ¥å‘Šç±»å‹æ˜ å°„å¤±è´¥
<strong>è§£å†³</strong>ï¼šåˆ›å»ºè‡ªå®šä¹‰æ˜ å°„è§„åˆ™æˆ–ç»Ÿä¸€æ¶ˆæ¯å®šä¹‰</p>
<h3 id="5">é™·é˜± 5ï¼šæ„å»ºç³»ç»Ÿç¼“å­˜é—®é¢˜</h3>
<p><strong>é—®é¢˜</strong>ï¼šcolcon ç¼“å­˜å¯¼è‡´ä¿®æ”¹æœªç”Ÿæ•ˆ
<strong>ç—‡çŠ¶</strong>ï¼šä»£ç ä¿®æ”¹åè¡Œä¸ºæœªæ”¹å˜
<strong>è§£å†³</strong>ï¼šä½¿ç”¨ <code>--cmake-clean-cache</code> æˆ–åˆ é™¤ build/install ç›®å½•</p>
<h3 id="6dds-id">é™·é˜± 6ï¼šDDS åŸŸ ID å†²çª</h3>
<p><strong>é—®é¢˜</strong>ï¼šå¤šä¸ª ROS2 å®ä¾‹ä½¿ç”¨ç›¸åŒåŸŸ ID
<strong>ç—‡çŠ¶</strong>ï¼šæ¥æ”¶åˆ°éé¢„æœŸçš„æ¶ˆæ¯
<strong>è§£å†³</strong>ï¼šé€šè¿‡ <code>ROS_DOMAIN_ID</code> ç¯å¢ƒå˜é‡éš”ç¦»</p>
<h3 id="7">é™·é˜± 7ï¼šç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹çŠ¶æ€ä¸ä¸€è‡´</h3>
<p><strong>é—®é¢˜</strong>ï¼šèŠ‚ç‚¹çŠ¶æ€è½¬æ¢å¤±è´¥ä½†ç³»ç»Ÿç»§ç»­è¿è¡Œ
<strong>ç—‡çŠ¶</strong>ï¼šéƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨ï¼Œæ—¥å¿—æ— æ˜æ˜¾é”™è¯¯
<strong>è§£å†³</strong>ï¼šå®ç°çŠ¶æ€ç›‘æ§å’Œè‡ªåŠ¨æ¢å¤æœºåˆ¶</p>
<h3 id="8">é™·é˜± 8ï¼šå†…å­˜æ³„æ¼åœ¨é•¿æ—¶é—´è¿è¡Œ</h3>
<p><strong>é—®é¢˜</strong>ï¼šbridge æˆ–è½¬æ¢ä»£ç å­˜åœ¨å†…å­˜æ³„æ¼
<strong>ç—‡çŠ¶</strong>ï¼šç³»ç»Ÿè¿è¡Œæ•°å°æ—¶åæ€§èƒ½ä¸‹é™
<strong>è§£å†³</strong>ï¼šä½¿ç”¨ valgrind æˆ– AddressSanitizer æ£€æµ‹</p>
<h2 id="311_1">3.11 æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•</h2>
<h3 id="_8">è¿ç§»å‰å‡†å¤‡</h3>
<ul>
<li>[ ] å®Œæˆç³»ç»Ÿæ¶æ„æ–‡æ¡£å’Œä¾èµ–åˆ†æ</li>
<li>[ ] å»ºç«‹æ€§èƒ½åŸºå‡†æµ‹è¯•å¥—ä»¶</li>
<li>[ ] è¯„ä¼°ç¬¬ä¸‰æ–¹åº“ ROS2 æ”¯æŒæƒ…å†µ</li>
<li>[ ] åˆ¶å®šè¯¦ç»†çš„è¿ç§»æ—¶é—´è¡¨</li>
<li>[ ] å‡†å¤‡å›æ»šæ–¹æ¡ˆå’Œåº”æ€¥é¢„æ¡ˆ</li>
<li>[ ] å®Œæˆå›¢é˜Ÿ ROS2 åŸ¹è®­</li>
</ul>
<h3 id="_9">è¿ç§»è¿‡ç¨‹ä¸­</h3>
<ul>
<li>[ ] ä¿æŒ CI/CD ç®¡é“æ­£å¸¸è¿è¡Œ</li>
<li>[ ] æ¯ä¸ªé‡Œç¨‹ç¢‘è¿›è¡Œæ€§èƒ½å¯¹æ¯”æµ‹è¯•</li>
<li>[ ] ç»´æŠ¤è¿ç§»è¿›åº¦è·Ÿè¸ªæ–‡æ¡£</li>
<li>[ ] å®šæœŸä¸åˆ©ç›Šç›¸å…³è€…æ²Ÿé€šè¿›å±•</li>
<li>[ ] åŠæ—¶æ›´æ–°ç³»ç»Ÿæ–‡æ¡£</li>
<li>[ ] ä¿æŒåŒç³»ç»Ÿè¿è¡Œèƒ½åŠ›</li>
</ul>
<h3 id="_10">ä»£ç è´¨é‡</h3>
<ul>
<li>[ ] éµå¾ª ROS2 ç¼–ç è§„èŒƒ</li>
<li>[ ] ä½¿ç”¨ç°ä»£ C++ ç‰¹æ€§ï¼ˆC++14/17ï¼‰</li>
<li>[ ] å®ç°å®Œæ•´çš„é”™è¯¯å¤„ç†</li>
<li>[ ] æ·»åŠ å……åˆ†çš„æ—¥å¿—è®°å½•</li>
<li>[ ] ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•</li>
<li>[ ] è¿›è¡Œä»£ç å®¡æŸ¥</li>
</ul>
<h3 id="_11">æ€§èƒ½ä¼˜åŒ–</h3>
<ul>
<li>[ ] é…ç½®åˆé€‚çš„ QoS ç­–ç•¥</li>
<li>[ ] ä¼˜åŒ–é«˜é¢‘æ¶ˆæ¯ä¼ è¾“è·¯å¾„</li>
<li>[ ] å®ç°é›¶æ‹·è´whereå¯èƒ½</li>
<li>[ ] è°ƒä¼˜ DDS å‚æ•°</li>
<li>[ ] ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ</li>
<li>[ ] è¿›è¡Œå‹åŠ›æµ‹è¯•</li>
</ul>
<h3 id="_12">éƒ¨ç½²éªŒè¯</h3>
<ul>
<li>[ ] éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ</li>
<li>[ ] ç¡®è®¤æ€§èƒ½æ»¡è¶³è¦æ±‚</li>
<li>[ ] æµ‹è¯•æ•…éšœæ¢å¤æœºåˆ¶</li>
<li>[ ] éªŒè¯ä¸å¤–éƒ¨ç³»ç»Ÿé›†æˆ</li>
<li>[ ] å®Œæˆç”¨æˆ·éªŒæ”¶æµ‹è¯•</li>
<li>[ ] å‡†å¤‡è¿ç»´æ–‡æ¡£</li>
</ul>
<h3 id="_13">åæœŸç»´æŠ¤</h3>
<ul>
<li>[ ] ç§»é™¤ä¸å†éœ€è¦çš„ ROS1 ä»£ç </li>
<li>[ ] ä¼˜åŒ– ROS2 ç‰¹æ€§ä½¿ç”¨</li>
<li>[ ] å»ºç«‹ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶</li>
<li>[ ] åˆ¶å®šå‡çº§ç­–ç•¥</li>
<li>[ ] æ”¶é›†ç”¨æˆ·åé¦ˆ</li>
<li>[ ] æŒç»­æ€§èƒ½è°ƒä¼˜</li>
</ul>
            </article>
            
            <nav class="page-nav"><a href="chapter2.html" class="nav-link prev">â† ç¬¬ 2 ç« ï¼šROS1 çš„å±€é™æ€§åˆ†æ</a><a href="chapter4.html" class="nav-link next">ç¬¬ 4 ç« ï¼šROS2 æ¶æ„ä¸è®¾è®¡ç†å¿µ â†’</a></nav>
        </main>
    </div>
</body>
</html>