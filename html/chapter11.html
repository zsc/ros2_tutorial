<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>ç¬¬ 11 ç« ï¼šSLAM ä¸å®šä½ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>ç›®å½•</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="æœç´¢..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ROS2 å®Œå…¨æ•™ç¨‹ï¼šä»åŸç†åˆ°å®è·µ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 1 ç« ï¼šROS1 æ ¸å¿ƒæ¦‚å¿µå›é¡¾</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 2 ç« ï¼šROS1 çš„å±€é™æ€§åˆ†æ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 3 ç« ï¼šä» ROS1 åˆ° ROS2 çš„è¿ç§»ç­–ç•¥</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 4 ç« ï¼šROS2 æ¶æ„ä¸è®¾è®¡ç†å¿µ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 5 ç« ï¼šèŠ‚ç‚¹ä¸æ‰§è¡Œå™¨æ¨¡å‹</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 6 ç« ï¼šé€šä¿¡æœºåˆ¶æ·±åº¦è§£æ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 7 ç« ï¼šLaunch ç³»ç»Ÿä¸é…ç½®ç®¡ç†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 8 ç« ï¼štf2 åæ ‡å˜æ¢æ¡†æ¶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 9 ç« ï¼šæ—¶é—´åŒæ­¥ä¸å›æ”¾ç³»ç»Ÿ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 10 ç« ï¼šä¼ æ„Ÿå™¨æ•°æ®å¤„ç†ç®¡é“</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 11 ç« ï¼šSLAM ä¸å®šä½ç³»ç»Ÿ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 12 ç« ï¼šå¯¼èˆªæ ˆ Nav2</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 13 ç« ï¼šros2_control æ¡†æ¶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter14.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 14 ç« ï¼šMoveIt2 è¿åŠ¨è§„åˆ’</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter15.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 15 ç« ï¼šå®æ—¶ç³»ç»Ÿä¸æ€§èƒ½ä¼˜åŒ–</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter16.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 16 ç« ï¼šå®‰å…¨æ€§ä¸è¯Šæ–­ç³»ç»Ÿ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter17.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 17 ç« ï¼šä»¿çœŸé›†æˆï¼ˆGazebo/Ignitionï¼‰</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter18.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 18 ç« ï¼šå¤šæœºå™¨äººç³»ç»Ÿ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter19.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 19 ç« ï¼šè®¡ç®—æœºè§†è§‰ä¸æ·±åº¦å­¦ä¹ </span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter20.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 20 ç« ï¼šæœºå™¨äººå¼ºåŒ–å­¦ä¹ </span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter21.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 21 ç« ï¼šå¤§è¯­è¨€æ¨¡å‹ä¸å…·èº«æ™ºèƒ½</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter22.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 22 ç« ï¼šç¥ç»ç½‘ç»œè¿åŠ¨æ§åˆ¶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="11-slam">ç¬¬ 11 ç« ï¼šSLAM ä¸å®šä½ç³»ç»Ÿ</h1>
<p>æœ¬ç« æ·±å…¥æ¢è®¨ ROS2 ä¸­çš„åŒæ—¶å®šä½ä¸åœ°å›¾æ„å»ºï¼ˆSLAMï¼‰æŠ€æœ¯å’Œå®šä½ç³»ç»Ÿã€‚æˆ‘ä»¬å°†ä»ç»å…¸çš„è‡ªé€‚åº”è’™ç‰¹å¡æ´›å®šä½ï¼ˆAMCLï¼‰å¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°ç°ä»£å›¾ä¼˜åŒ– SLAM æ–¹æ³•ï¼Œæœ€åè®¨è®ºå¤šä¼ æ„Ÿå™¨èåˆå®šä½ç­–ç•¥ã€‚é€šè¿‡å­¦ä¹ æœ¬ç« ï¼Œè¯»è€…å°†æŒæ¡åœ¨å¤æ‚ç¯å¢ƒä¸­å®ç°æœºå™¨äººç²¾ç¡®å®šä½çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œç†è§£ä¸åŒå®šä½æ–¹æ³•çš„é€‚ç”¨åœºæ™¯ï¼Œå¹¶èƒ½å¤Ÿæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©å’Œä¼˜åŒ–å®šä½æ–¹æ¡ˆã€‚</p>
<h2 id="111-amcl">11.1 AMCL å®šä½åŸç†</h2>
<p>è‡ªé€‚åº”è’™ç‰¹å¡æ´›å®šä½ï¼ˆAdaptive Monte Carlo Localization, AMCLï¼‰æ˜¯ ROS2 ä¸­æœ€å¸¸ç”¨çš„æ¦‚ç‡å®šä½ç®—æ³•ï¼ŒåŸºäºç²’å­æ»¤æ³¢å®ç°å…¨å±€å®šä½å’Œä½å§¿è·Ÿè¸ªã€‚</p>
<h3 id="1111">11.1.1 ç²’å­æ»¤æ³¢åŸºç¡€</h3>
<p>AMCL ä½¿ç”¨ç²’å­é›†åˆè¡¨ç¤ºæœºå™¨äººä½å§¿çš„æ¦‚ç‡åˆ†å¸ƒï¼š</p>
<p>$$
\text{Bel}(x_t) \approx \{x_t^{[i]}, w_t^{[i]}\}_{i=1}^N
$$</p>
<p>å…¶ä¸­ $x_t^{[i]} = (x, y, \theta)$ è¡¨ç¤ºç¬¬ $i$ ä¸ªç²’å­çš„ä½å§¿ï¼Œ$w_t^{[i]}$ æ˜¯å¯¹åº”æƒé‡ã€‚</p>
<p>ç²’å­æ»¤æ³¢çš„æ ¸å¿ƒæ­¥éª¤ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">é¢„æµ‹æ­¥éª¤</span><span class="err">ï¼ˆ</span><span class="n">è¿åŠ¨æ›´æ–°</span><span class="err">ï¼‰</span>
<span class="w">   </span><span class="n">å¯¹æ¯ä¸ªç²’å­</span><span class="w"> </span><span class="nl">i</span><span class="p">:</span>
<span class="w">   </span><span class="n">x_t</span><span class="o">^[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_motion_model</span><span class="p">(</span><span class="n">u_t</span><span class="p">,</span><span class="w"> </span><span class="n">x_</span><span class="err">{</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="err">}</span><span class="o">^[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">æ›´æ–°æ­¥éª¤</span><span class="err">ï¼ˆ</span><span class="n">è§‚æµ‹æ›´æ–°</span><span class="err">ï¼‰</span>
<span class="w">   </span><span class="n">å¯¹æ¯ä¸ªç²’å­</span><span class="w"> </span><span class="nl">i</span><span class="p">:</span>
<span class="w">   </span><span class="n">w_t</span><span class="o">^[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measurement_model</span><span class="p">(</span><span class="n">z_t</span><span class="p">,</span><span class="w"> </span><span class="n">x_t</span><span class="o">^[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">é‡é‡‡æ ·</span>
<span class="w">   </span><span class="n">å¦‚æœæœ‰æ•ˆç²’å­æ•°</span><span class="w"> </span><span class="n">N_eff</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">é˜ˆå€¼</span><span class="p">:</span>
<span class="w">   </span><span class="n">æ‰§è¡Œé‡é‡‡æ ·</span><span class="err">ï¼Œ</span><span class="n">ç”Ÿæˆæ–°ç²’å­é›†</span>
</code></pre></div>

<h3 id="1112">11.1.2 è¿åŠ¨æ¨¡å‹</h3>
<p>AMCL æ”¯æŒä¸‰ç§è¿åŠ¨æ¨¡å‹ï¼š</p>
<ol>
<li><strong>å·®åˆ†é©±åŠ¨æ¨¡å‹ï¼ˆDifferential Modelï¼‰</strong></li>
</ol>
<p>é€‚ç”¨äºå·®åˆ†é©±åŠ¨æœºå™¨äººï¼Œè€ƒè™‘å¹³ç§»å’Œæ—‹è½¬å™ªå£°ï¼š</p>
<p>$$
\begin{aligned}
\delta_{rot1} &amp;= \text{atan2}(\Delta y, \Delta x) - \theta_{t-1} \\
\delta_{trans} &amp;= \sqrt{\Delta x^2 + \Delta y^2} \\
\delta_{rot2} &amp;= \theta_t - \theta_{t-1} - \delta_{rot1}
\end{aligned}
$$</p>
<p>å™ªå£°å‚æ•°ï¼š</p>
<ul>
<li><code>alpha1</code>: æ—‹è½¬å¼•èµ·çš„æ—‹è½¬å™ªå£°</li>
<li><code>alpha2</code>: å¹³ç§»å¼•èµ·çš„æ—‹è½¬å™ªå£°  </li>
<li><code>alpha3</code>: å¹³ç§»å¼•èµ·çš„å¹³ç§»å™ªå£°</li>
<li><code>alpha4</code>: æ—‹è½¬å¼•èµ·çš„å¹³ç§»å™ªå£°</li>
</ul>
<ol start="2">
<li><strong>å…¨å‘æ¨¡å‹ï¼ˆOmni Modelï¼‰</strong></li>
</ol>
<p>é€‚ç”¨äºå…¨å‘ç§»åŠ¨æœºå™¨äººï¼Œç‹¬ç«‹å¤„ç† xã€yã€Î¸ æ–¹å‘ï¼š</p>
<p>$$
\begin{aligned}
x_t &amp;= x_{t-1} + \Delta x + \epsilon_x \\
y_t &amp;= y_{t-1} + \Delta y + \epsilon_y \\
\theta_t &amp;= \theta_{t-1} + \Delta \theta + \epsilon_\theta
\end{aligned}
$$</p>
<ol start="3">
<li><strong>é™æ€æ¨¡å‹ï¼ˆStationary Modelï¼‰</strong></li>
</ol>
<p>ç”¨äºæœºå™¨äººé™æ­¢æ—¶çš„å®šä½ç»´æŒï¼Œä»…æ·»åŠ å°‘é‡å™ªå£°é˜²æ­¢ç²’å­é€€åŒ–ã€‚</p>
<h3 id="1113">11.1.3 è§‚æµ‹æ¨¡å‹</h3>
<p>AMCL çš„æ¿€å…‰é›·è¾¾è§‚æµ‹æ¨¡å‹æ··åˆå››ç§æ¦‚ç‡åˆ†å¸ƒï¼š</p>
<p>$$
p(z_t|x_t, m) = z_{hit} \cdot p_{hit} + z_{short} \cdot p_{short} + z_{max} \cdot p_{max} + z_{rand} \cdot p_{rand}
$$</p>
<p>å„åˆ†é‡å«ä¹‰ï¼š</p>
<ul>
<li><strong>$p_{hit}$</strong>: é«˜æ–¯åˆ†å¸ƒï¼Œå»ºæ¨¡æµ‹é‡å™ªå£°</li>
<li><strong>$p_{short}$</strong>: æŒ‡æ•°åˆ†å¸ƒï¼Œå»ºæ¨¡åŠ¨æ€éšœç¢ç‰©</li>
<li><strong>$p_{max}$</strong>: ç‚¹è´¨é‡åˆ†å¸ƒï¼Œå»ºæ¨¡æœ€å¤§æµ‹è·</li>
<li><strong>$p_{rand}$</strong>: å‡åŒ€åˆ†å¸ƒï¼Œå»ºæ¨¡éšæœºå™ªå£°</li>
</ul>
<p>ä¼¼ç„¶åœºæ¨¡å‹ï¼ˆLikelihood Field Modelï¼‰ä¼˜åŒ–ï¼š</p>
<div class="codehilite"><pre><span></span><code>å¯¹äºæ¿€å…‰ç‚¹ (x_k, y_k):

1. è®¡ç®—åˆ°æœ€è¿‘éšœç¢ç‰©çš„è·ç¦» d
2. ä¼¼ç„¶å€¼ = exp(-dÂ²/(2ÏƒÂ²))
3. æ€»ä¼¼ç„¶ = âˆ å„ç‚¹ä¼¼ç„¶å€¼
</code></pre></div>

<h3 id="1114">11.1.4 è‡ªé€‚åº”ç²’å­æ•°</h3>
<p>AMCL é€šè¿‡ KLD é‡‡æ ·åŠ¨æ€è°ƒæ•´ç²’å­æ•°ï¼š</p>
<p>$$
N = \frac{k-1}{2\epsilon} \left\{1 - \frac{2}{9(k-1)} + \sqrt{\frac{2}{9(k-1)}}z_{1-\delta}\right\}^3
$$</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>$k$: å ç”¨çš„ç›´æ–¹å›¾å•å…ƒæ•°</li>
<li>$\epsilon$: KLD è¯¯å·®ä¸Šç•Œ</li>
<li>$\delta$: ç½®ä¿¡åº¦å‚æ•°</li>
</ul>
<h3 id="1115">11.1.5 å‚æ•°è°ƒä¼˜ç­–ç•¥</h3>
<p>å…³é”®å‚æ•°åŠè°ƒä¼˜å»ºè®®ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ç²’å­æ•°é…ç½®</span>
<span class="nt">min_particles</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w">      </span><span class="c1"># æœ€å°‘ç²’å­æ•°ï¼Œå¢åŠ æé«˜ç²¾åº¦</span>
<span class="nt">max_particles</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span><span class="w">     </span><span class="c1"># æœ€å¤§ç²’å­æ•°ï¼Œé™åˆ¶è®¡ç®—é‡</span>

<span class="c1"># è¿åŠ¨æ¨¡å‹å™ªå£°ï¼ˆå·®åˆ†é©±åŠ¨ï¼‰</span>
<span class="nt">alpha1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w">   </span><span class="c1"># å‡å°ä½¿ç²’å­æ›´é›†ä¸­</span>
<span class="nt">alpha2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w">   </span><span class="c1"># å¢å¤§åº”å¯¹æ‰“æ»‘</span>
<span class="nt">alpha3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w">   </span><span class="c1"># æ ¹æ®é‡Œç¨‹è®¡ç²¾åº¦è°ƒæ•´</span>
<span class="nt">alpha4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w">   </span><span class="c1"># é€šå¸¸è¾ƒå°</span>

<span class="c1"># æ¿€å…‰æ¨¡å‹å‚æ•°</span>
<span class="nt">laser_z_hit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span><span class="w">        </span><span class="c1"># æ­£ç¡®æµ‹é‡æƒé‡</span>
<span class="nt">laser_z_short</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w">     </span><span class="c1"># åŠ¨æ€éšœç¢ç‰©æƒé‡</span>
<span class="nt">laser_z_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w">       </span><span class="c1"># æœ€å¤§æµ‹è·æƒé‡</span>
<span class="nt">laser_z_rand</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.4</span><span class="w">       </span><span class="c1"># éšæœºæµ‹é‡æƒé‡</span>
<span class="nt">laser_sigma_hit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w">    </span><span class="c1"># æµ‹é‡æ ‡å‡†å·®</span>

<span class="c1"># æ›´æ–°é¢‘ç‡</span>
<span class="nt">update_min_d</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.25</span><span class="w">      </span><span class="c1"># æœ€å°å¹³ç§»æ›´æ–°è·ç¦»(m)</span>
<span class="nt">update_min_a</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w">       </span><span class="c1"># æœ€å°æ—‹è½¬æ›´æ–°è§’åº¦(rad)</span>

<span class="c1"># é‡é‡‡æ ·é˜ˆå€¼</span>
<span class="nt">resample_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">    </span><span class="c1"># é‡é‡‡æ ·é—´éš”</span>
<span class="nt">recovery_alpha_slow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.001</span><span class="w">  </span><span class="c1"># æ…¢é€Ÿå¹³å‡ï¼Œç”¨äºæ£€æµ‹å®šä½å¤±è´¥</span>
<span class="nt">recovery_alpha_fast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w">    </span><span class="c1"># å¿«é€Ÿå¹³å‡</span>
</code></pre></div>

<p>è°ƒä¼˜æµç¨‹ï¼š</p>
<ol>
<li>ä»é»˜è®¤å‚æ•°å¼€å§‹</li>
<li>æ ¹æ®é‡Œç¨‹è®¡è´¨é‡è°ƒæ•´è¿åŠ¨å™ªå£°</li>
<li>æ ¹æ®æ¿€å…‰é›·è¾¾ç‰¹æ€§è°ƒæ•´è§‚æµ‹æ¨¡å‹</li>
<li>åœ¨è®¡ç®—èµ„æºå…è®¸ä¸‹å¢åŠ ç²’å­æ•°</li>
<li>ä½¿ç”¨ rviz2 å¯è§†åŒ–ç²’å­äº‘è¯„ä¼°æ”¶æ•›æ€§</li>
</ol>
<h2 id="112-slam-slam_toolbox">11.2 SLAM å·¥å…·é“¾ï¼ˆslam_toolboxï¼‰</h2>
<p>slam_toolbox æ˜¯ ROS2 æ¨èçš„ 2D SLAM è§£å†³æ–¹æ¡ˆï¼ŒåŸºäºå›¾ä¼˜åŒ–æä¾›åœ¨çº¿å’Œç¦»çº¿å»ºå›¾èƒ½åŠ›ã€‚</p>
<h3 id="1121-slam">11.2.1 å›¾ä¼˜åŒ– SLAM åŸç†</h3>
<p>slam_toolbox ä½¿ç”¨ä½å§¿å›¾ï¼ˆPose Graphï¼‰è¡¨ç¤º SLAM é—®é¢˜ï¼š</p>
<p>$$
x^* = \arg\min_x \sum_{ij} e_{ij}^T \Omega_{ij} e_{ij}
$$</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>$x = \{x_1, ..., x_n\}$: æœºå™¨äººä½å§¿åºåˆ—</li>
<li>$e_{ij} = z_{ij} - h(x_i, x_j)$: æµ‹é‡æ®‹å·®</li>
<li>$\Omega_{ij}$: ä¿¡æ¯çŸ©é˜µï¼ˆåæ–¹å·®é€†ï¼‰</li>
</ul>
<p>æ ¸å¿ƒç»„ä»¶ï¼š</p>
<div class="codehilite"><pre><span></span><code>å›¾ç»“æ„ï¼š

<span class="k">-</span> èŠ‚ç‚¹(Vertex): æœºå™¨äººä½å§¿ x_i = (x, y, Î¸)
<span class="k">-</span> è¾¹(Edge): ä½å§¿é—´çº¦æŸ
  <span class="k">-</span> é‡Œç¨‹è®¡è¾¹: è¿ç»­ä½å§¿é—´
  <span class="k">-</span> å›ç¯è¾¹: æ£€æµ‹åˆ°å›ç¯æ—¶æ·»åŠ 
  <span class="k">-</span> æ¿€å…‰åŒ¹é…è¾¹: scan-to-map åŒ¹é…

ä¼˜åŒ–å™¨ï¼š

<span class="k">-</span> ä½¿ç”¨ Sparse Pose Adjustment (SPA)
<span class="k">-</span> Levenberg-Marquardt è¿­ä»£æ±‚è§£
<span class="k">-</span> å¢é‡å¼ä¼˜åŒ–å‡å°‘è®¡ç®—é‡
</code></pre></div>

<h3 id="1122">11.2.2 æ‰«æåŒ¹é…ç®—æ³•</h3>
<p>slam_toolbox ä½¿ç”¨ç›¸å…³æ€§æ‰«æåŒ¹é…ï¼ˆCorrelative Scan Matchingï¼‰ï¼š</p>
<ol>
<li><strong>ç²—åŒ¹é…ï¼ˆBranch-and-Boundï¼‰</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="err">æœç´¢ç©ºé—´ç¦»æ•£åŒ–</span><span class="o">:</span>

<span class="o">-</span><span class="w"> </span><span class="err">ä½ç½®</span><span class="o">:</span><span class="w"> </span><span class="err">Î”</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="err">Î”</span><span class="n">y</span><span class="w"> </span><span class="err">âˆˆ</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="n">search_size</span><span class="p">,</span><span class="w"> </span><span class="n">search_size</span><span class="p">]</span>
<span class="o">-</span><span class="w"> </span><span class="err">è§’åº¦</span><span class="o">:</span><span class="w"> </span><span class="err">Î”Î¸</span><span class="w"> </span><span class="err">âˆˆ</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="n">search_angle</span><span class="p">,</span><span class="w"> </span><span class="n">search_angle</span><span class="p">]</span>

<span class="err">åˆ†æ”¯å®šç•ŒåŠ é€Ÿ</span><span class="o">:</span>

<span class="mf">1.</span><span class="w"> </span><span class="err">è®¡ç®—ä¸Šç•Œ</span><span class="w"> </span><span class="n">upper_bound</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="mf">2.</span><span class="w"> </span><span class="err">å¦‚æœ</span><span class="w"> </span><span class="n">upper_bound</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">current_best:</span>
<span class="w">   </span><span class="err">å‰ªæè¯¥åˆ†æ”¯</span>

<span class="mf">3.</span><span class="w"> </span><span class="err">å¦åˆ™ç»§ç»­ç»†åˆ†</span>
</code></pre></div>

<ol start="2">
<li><strong>ç²¾åŒ¹é…ï¼ˆHill Climbingï¼‰</strong></li>
</ol>
<p>$$
\text{score} = \sum_{i} M(T(p_i))
$$</p>
<p>å…¶ä¸­ $M$ æ˜¯å ç”¨æ …æ ¼åœ°å›¾ï¼Œ$T$ æ˜¯å˜æ¢ï¼Œ$p_i$ æ˜¯æ¿€å…‰ç‚¹ã€‚</p>
<p>ä½¿ç”¨æ¢¯åº¦ä¸Šå‡ä¼˜åŒ–ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">converged</span>:
<span class="w">  </span>è®¡ç®—å½“å‰ä½å§¿å¾—åˆ†
<span class="w">  </span>å°è¯•<span class="mi">6</span>ä¸ªæ–¹å‘<span class="ss">(</span>Â±Î”<span class="nv">x</span>,<span class="w"> </span>Â±Î”<span class="nv">y</span>,<span class="w"> </span>Â±Î”Î¸<span class="ss">)</span>
<span class="w">  </span>é€‰æ‹©å¾—åˆ†æœ€é«˜çš„æ–¹å‘
<span class="w">  </span>æ›´æ–°æ­¥é•¿ï¼ˆè‡ªé€‚åº”ï¼‰
</code></pre></div>

<h3 id="1123">11.2.3 åœ¨çº¿ä¸ç¦»çº¿å»ºå›¾</h3>
<p><strong>åœ¨çº¿å»ºå›¾ï¼ˆOnline SLAMï¼‰</strong></p>
<p>å®æ—¶æ„å»ºå’Œä¼˜åŒ–åœ°å›¾ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># åœ¨çº¿æ¨¡å¼é…ç½®</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mapping</span>

<span class="c1"># æ‰«æç¼“å†²</span>
<span class="nt">scan_buffer_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">scan_buffer_maximum_scan_distance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0</span>

<span class="c1"># åŒ¹é…å‚æ•°</span>
<span class="nt">distance_variance_penalty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">angle_variance_penalty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="nt">fine_search_angle_offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.00349</span>

<span class="c1"># å›ç¯æ£€æµ‹</span>
<span class="nt">loop_search_space_dimension</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.0</span>
<span class="nt">loop_search_space_resolution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span>
<span class="nt">loop_search_space_smear_deviation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.03</span>

<span class="c1"># ä¼˜åŒ–è§¦å‘</span>
<span class="nt">minimum_travel_distance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">minimum_travel_heading</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
</code></pre></div>

<p><strong>ç¦»çº¿å»ºå›¾ï¼ˆOffline SLAMï¼‰</strong></p>
<p>æ‰¹å¤„ç†ä¼˜åŒ–å·²å½•åˆ¶æ•°æ®ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ç¦»çº¿æ¨¡å¼é…ç½®</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localization_and_mapping</span>

<span class="c1"># å…¨å±€ä¼˜åŒ–</span>
<span class="nt">do_loop_closing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">loop_match_minimum_chain_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">loop_match_maximum_variance_coarse</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0</span>
<span class="nt">loop_match_minimum_response_coarse</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.35</span>

<span class="c1"># æ‰¹å¤„ç†ä¼˜åŒ–</span>
<span class="nt">optimization_frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20.0</span>
<span class="nt">global_optimization_frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
</code></pre></div>

<p>ç¦»çº¿å¤„ç†æµç¨‹ï¼š</p>
<ol>
<li>åŠ è½½ rosbag æ–‡ä»¶</li>
<li>é¡ºåºå¤„ç†æ¿€å…‰æ‰«æ</li>
<li>å®šæœŸæ‰§è¡Œå…¨å±€ä¼˜åŒ–</li>
<li>ä¿å­˜ä¼˜åŒ–åçš„åœ°å›¾</li>
</ol>
<h3 id="1124">11.2.4 å›ç¯æ£€æµ‹ä¸é—­åˆ</h3>
<p>å›ç¯æ£€æµ‹ç­–ç•¥ï¼š</p>
<ol>
<li><strong>å€™é€‰æ£€æµ‹</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_loop_candidates</span><span class="p">(</span><span class="n">current_pose</span><span class="p">,</span> <span class="n">pose_graph</span><span class="p">):</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pose_graph</span><span class="p">:</span>
        <span class="c1"># ç©ºé—´æ¥è¿‘ä½†æ—¶é—´è¿œç¦»</span>
        <span class="n">spatial_dist</span> <span class="o">=</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">current_pose</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">pose</span><span class="p">)</span>
        <span class="n">temporal_dist</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">time</span>

        <span class="k">if</span> <span class="n">spatial_dist</span> <span class="o">&lt;</span> <span class="n">loop_search_radius</span> <span class="ow">and</span> \
           <span class="n">temporal_dist</span> <span class="o">&gt;</span> <span class="n">minimum_time_interval</span><span class="p">:</span>
            <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div>

<ol start="2">
<li><strong>éªŒè¯ä¸ä¼˜åŒ–</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="err">å¯¹æ¯ä¸ªå€™é€‰</span><span class="o">:</span>

<span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="err">æ‰§è¡Œæ‰«æåŒ¹é…</span>
<span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="err">è®¡ç®—åŒ¹é…å¾—åˆ†å’Œåæ–¹å·®</span>
<span class="mi">3</span><span class="o">.</span><span class="w"> </span><span class="err">å¦‚æœå¾—åˆ†</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="err">é˜ˆå€¼</span><span class="o">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">æ·»åŠ å›ç¯çº¦æŸè¾¹</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">è§¦å‘å›¾ä¼˜åŒ–</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">æ›´æ–°åœ°å›¾</span>
</code></pre></div>

<h3 id="1125">11.2.5 åœ°å›¾åºåˆ—åŒ–ä¸ç®¡ç†</h3>
<p>slam_toolbox çš„åœ°å›¾æ ¼å¼ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># .posegraph æ–‡ä»¶æ ¼å¼</span>
<span class="nt">header</span><span class="p">:</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class="w">  </span><span class="nt">robot_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;robot_0&quot;</span>

<span class="nt">nodes</span><span class="p">:</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">pose</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">x</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">y</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">theta</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">scan</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ranges</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">angles</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1234567890.123</span>

<span class="nt">edges</span><span class="p">:</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;odometry&quot;</span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">transform</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">dx</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">dy</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">dtheta</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">information</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[[</span><span class="nv">3x3 matrix</span><span class="p p-Indicator">]]</span>

<span class="nt">map_data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">resolution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span>
<span class="w">  </span><span class="nt">origin</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">occupancy_grid</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p>åœ°å›¾æ“ä½œ APIï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ä¿å­˜åœ°å›¾</span>
<span class="n">slam_toolbox</span><span class="o">.</span><span class="n">save_map</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;warehouse_map&quot;</span><span class="p">)</span>

<span class="c1"># åŠ è½½åœ°å›¾ç»§ç»­å»ºå›¾</span>
<span class="n">slam_toolbox</span><span class="o">.</span><span class="n">deserialize_map</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;warehouse_map.posegraph&quot;</span><span class="p">)</span>

<span class="c1"># åˆå¹¶å¤šä¸ªåœ°å›¾</span>
<span class="n">slam_toolbox</span><span class="o">.</span><span class="n">merge_maps</span><span class="p">(</span>
    <span class="n">maps</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;floor1.posegraph&quot;</span><span class="p">,</span> <span class="s2">&quot;floor2.posegraph&quot;</span><span class="p">],</span>
    <span class="n">output</span><span class="o">=</span><span class="s2">&quot;building.posegraph&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="113">11.3 åœ°å›¾æœåŠ¡å™¨æ¶æ„</h2>
<p>ROS2 çš„åœ°å›¾æœåŠ¡å™¨è´Ÿè´£åœ°å›¾çš„åŠ è½½ã€å‘å¸ƒå’Œç®¡ç†ï¼Œæ”¯æŒå¤šç§åœ°å›¾æ ¼å¼å’ŒåŠ¨æ€æ›´æ–°ã€‚</p>
<h3 id="1131">11.3.1 åœ°å›¾æ ¼å¼ä¸è¡¨ç¤º</h3>
<p><strong>å ç”¨æ …æ ¼åœ°å›¾ï¼ˆOccupancyGridï¼‰</strong></p>
<p>æ ‡å‡† 2D åœ°å›¾è¡¨ç¤ºï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># map.yaml é…ç½®æ–‡ä»¶</span>
<span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warehouse.pgm</span>
<span class="nt">resolution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w">  </span><span class="c1"># ç±³/åƒç´ </span>
<span class="nt">origin</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">-10.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">-10.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [x, y, yaw]</span>
<span class="nt">negate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">  </span><span class="c1"># 0=ç™½è‰²è‡ªç”±,1=é»‘è‰²è‡ªç”±</span>
<span class="nt">occupied_thresh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.65</span><span class="w">  </span><span class="c1"># &gt;æ­¤å€¼ä¸ºå ç”¨</span>
<span class="nt">free_thresh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.196</span><span class="w">     </span><span class="c1"># &lt;æ­¤å€¼ä¸ºè‡ªç”±</span>

<span class="c1"># æ …æ ¼å€¼å«ä¹‰</span>
<span class="c1"># -1: æœªçŸ¥åŒºåŸŸ</span>
<span class="c1">#  0: è‡ªç”±ç©ºé—´</span>
<span class="c1">#  100: å ç”¨ï¼ˆéšœç¢ç‰©ï¼‰</span>
<span class="c1"># 1-99: å ç”¨æ¦‚ç‡</span>
</code></pre></div>

<p>åœ°å›¾æ¶ˆæ¯ç»“æ„ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># nav_msgs/msg/OccupancyGrid</span>
<span class="n">header</span><span class="p">:</span>
  <span class="n">stamp</span><span class="p">:</span> <span class="p">{</span><span class="n">sec</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nanosec</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
  <span class="n">frame_id</span><span class="p">:</span> <span class="s2">&quot;map&quot;</span>

<span class="n">info</span><span class="p">:</span>
  <span class="n">map_load_time</span><span class="p">:</span> <span class="p">{</span><span class="n">sec</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nanosec</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
  <span class="n">resolution</span><span class="p">:</span> <span class="mf">0.05</span>
  <span class="n">width</span><span class="p">:</span> <span class="mi">2048</span>
  <span class="n">height</span><span class="p">:</span> <span class="mi">2048</span>
  <span class="n">origin</span><span class="p">:</span>
    <span class="n">position</span><span class="p">:</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="mf">51.2</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mf">51.2</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
    <span class="n">orientation</span><span class="p">:</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>

<span class="n">data</span><span class="p">:</span> <span class="p">[</span><span class="n">int8</span> <span class="n">array</span><span class="p">]</span>  <span class="c1"># row-major order</span>
</code></pre></div>

<p><strong>æˆæœ¬åœ°å›¾ï¼ˆCostmapï¼‰</strong></p>
<p>ç”¨äºå¯¼èˆªçš„è†¨èƒ€åœ°å›¾ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="err">æˆæœ¬å€¼å®šä¹‰</span><span class="o">:</span>
<span class="mi">0</span><span class="o">:</span><span class="w"> </span><span class="err">è‡ªç”±ç©ºé—´</span>
<span class="mi">1</span><span class="o">-</span><span class="mi">252</span><span class="o">:</span><span class="w"> </span><span class="err">æˆæœ¬é€’å¢</span>
<span class="mi">253</span><span class="o">:</span><span class="w"> </span><span class="err">è†¨èƒ€åŠå¾„å†…</span>
<span class="mi">254</span><span class="o">:</span><span class="w"> </span><span class="err">è‡´å‘½éšœç¢ç‰©è†¨èƒ€åŒº</span>
<span class="mi">255</span><span class="o">:</span><span class="w"> </span><span class="err">è‡´å‘½éšœç¢ç‰©</span>

<span class="err">è†¨èƒ€å‡½æ•°</span><span class="o">:</span>
<span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">253</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">exp</span><span class="o">(-</span><span class="err">Î±</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="o">)</span>
<span class="err">å…¶ä¸­</span><span class="w"> </span><span class="err">Î±</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ln</span><span class="o">(</span><span class="mf">0.01</span><span class="o">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">inflation_radius</span>
</code></pre></div>

<h3 id="1132-map_server">11.3.2 map_server è®¾è®¡</h3>
<p>ROS2 map_server èŠ‚ç‚¹æ¶æ„ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">map_server</span><span class="w"> </span><span class="err">ç»„ä»¶</span><span class="p">:</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">MapServer</span><span class="w"> </span><span class="p">(</span><span class="err">åŠ è½½å’Œå‘å¸ƒé™æ€åœ°å›¾</span><span class="p">)</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">æœåŠ¡</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">map_server</span><span class="o">/</span><span class="n">load_map</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">è¯é¢˜</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">OccupancyGrid</span><span class="p">)</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">å‚æ•°</span><span class="p">:</span><span class="w"> </span><span class="n">yaml_filename</span>
<span class="err">â”‚</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">MapSaver</span><span class="w"> </span><span class="p">(</span><span class="err">ä¿å­˜åœ°å›¾åˆ°æ–‡ä»¶</span><span class="p">)</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">æœåŠ¡</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">map_server</span><span class="o">/</span><span class="n">save_map</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">è®¢é˜…</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">map</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">å‚æ•°</span><span class="p">:</span><span class="w"> </span><span class="n">save_map_timeout</span>
<span class="err">â”‚</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">CostmapServer</span><span class="w"> </span><span class="p">(</span><span class="err">æˆæœ¬åœ°å›¾ç®¡ç†</span><span class="p">)</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">è¯é¢˜</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">global_costmap</span><span class="o">/</span><span class="n">costmap</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">æœåŠ¡</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">global_costmap</span><span class="o">/</span><span class="n">clear_entirely</span>
<span class="w">    </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">æ’ä»¶</span><span class="p">:</span><span class="w"> </span><span class="n">static_layer</span><span class="p">,</span><span class="w"> </span><span class="n">inflation_layer</span>
</code></pre></div>

<p>ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MapServer</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;map_server&#39;</span><span class="p">)</span>

        <span class="c1"># å£°æ˜å‚æ•°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s1">&#39;yaml_filename&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s1">&#39;frame_id&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s1">&#39;topic_name&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">)</span>

        <span class="c1"># åˆ›å»ºå‘å¸ƒè€…</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span>
            <span class="n">OccupancyGrid</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;topic_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">QoSProfile</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">durability</span><span class="o">=</span><span class="n">DurabilityPolicy</span><span class="o">.</span><span class="n">TRANSIENT_LOCAL</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># åˆ›å»ºæœåŠ¡</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_map_service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_service</span><span class="p">(</span>
            <span class="n">LoadMap</span><span class="p">,</span> 
            <span class="s1">&#39;load_map&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_map_callback</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_file</span><span class="p">):</span>
        <span class="c1"># åŠ è½½ YAML é…ç½®</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">map_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># åŠ è½½å›¾åƒæ–‡ä»¶</span>
        <span class="n">map_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">map_config</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># è½¬æ¢ä¸º OccupancyGrid</span>
        <span class="n">map_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_to_occupancy_grid</span><span class="p">(</span>
            <span class="n">map_image</span><span class="p">,</span> 
            <span class="n">map_config</span>
        <span class="p">)</span>

        <span class="c1"># å‘å¸ƒåœ°å›¾</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_publisher</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">map_msg</span><span class="p">)</span>
</code></pre></div>

<h3 id="1133">11.3.3 å¤šå±‚åœ°å›¾ç®¡ç†</h3>
<p>åˆ†å±‚åœ°å›¾æ¶æ„æ”¯æŒä¸åŒæŠ½è±¡çº§åˆ«ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># multi_layer_map.yaml</span>
<span class="nt">layers</span><span class="p">:</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;static_map&quot;</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;occupancy_grid&quot;</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;building_structure.pgm&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;semantic_layer&quot;</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;semantic_map&quot;</span>
<span class="w">    </span><span class="nt">regions</span><span class="p">:</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;office_101&quot;</span><span class="p p-Indicator">,</span><span class="nt"> polygon</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[[</span><span class="nv">x1</span><span class="p p-Indicator">,</span><span class="nv">y1</span><span class="p p-Indicator">],</span><span class="w"> </span><span class="nv">...</span><span class="p p-Indicator">]}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;corridor_A&quot;</span><span class="p p-Indicator">,</span><span class="nt"> polygon</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[[</span><span class="nv">x2</span><span class="p p-Indicator">,</span><span class="nv">y2</span><span class="p p-Indicator">],</span><span class="w"> </span><span class="nv">...</span><span class="p p-Indicator">]}</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;topology_layer&quot;</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;topology_map&quot;</span>
<span class="w">    </span><span class="nt">nodes</span><span class="p">:</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="nt"> name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;entrance&quot;</span><span class="p p-Indicator">,</span><span class="nt"> pose</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">x</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">y</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">theta</span><span class="p p-Indicator">]}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="nt"> name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;elevator&quot;</span><span class="p p-Indicator">,</span><span class="nt"> pose</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">x</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">y</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">theta</span><span class="p p-Indicator">]}</span>
<span class="w">    </span><span class="nt">edges</span><span class="p">:</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="nt"> to</span><span class="p">:</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="nt"> distance</span><span class="p">:</span><span class="w"> </span><span class="nv">15.0</span><span class="p p-Indicator">}</span>
</code></pre></div>

<p>å±‚é—´åŒæ­¥æœºåˆ¶ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MultiLayerMapServer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tf_buffer</span> <span class="o">=</span> <span class="n">Buffer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tf_listener</span> <span class="o">=</span> <span class="n">TransformListener</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf_buffer</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">layer_type</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">layer_type</span><span class="p">,</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
            <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">query_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æŸ¥è¯¢ä½ç½®çš„å¤šå±‚ä¿¡æ¯&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># å ç”¨ä¿¡æ¯</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;occupied&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;static_map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_occupied</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># è¯­ä¹‰ä¿¡æ¯</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;semantic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;semantic_layer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># æ‹“æ‰‘ä¿¡æ¯</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;nearest_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;topology_layer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nearest</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>

<h3 id="1134">11.3.4 åŠ¨æ€åœ°å›¾æ›´æ–°</h3>
<p>å®ç°åŠ¨æ€éšœç¢ç‰©å’Œåœ°å›¾ä¿®æ”¹ï¼š</p>
<p><strong>ä¸´æ—¶éšœç¢ç‰©å±‚</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DynamicObstacleLayer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obstacles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_rate</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># éšœç¢ç‰©æ¶ˆå¤±é€Ÿç‡</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_obstacle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ·»åŠ ä¸´æ—¶éšœç¢ç‰©&quot;&quot;&quot;</span>
        <span class="n">obstacle</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
            <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="n">radius</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_clock</span><span class="p">()</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">duration</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obstacles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obstacle</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_costmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">costmap</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ›´æ–°æˆæœ¬åœ°å›¾&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_clock</span><span class="p">()</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obstacles</span><span class="p">[:]:</span>
            <span class="n">age</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_time</span> <span class="o">-</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">nanoseconds</span> <span class="o">/</span> <span class="mf">1e9</span>

            <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obstacles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># æ¸å˜æ¶ˆå¤±æ•ˆæœ</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">age</span> <span class="o">/</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_obstacle_to_costmap</span><span class="p">(</span>
                    <span class="n">costmap</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">alpha</span>
                <span class="p">)</span>
</code></pre></div>

<p><strong>å¢é‡åœ°å›¾æ›´æ–°</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">IncrementalMapUpdate</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_laser_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">pose</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨æ¿€å…‰æ‰«ææ›´æ–°åœ°å›¾&quot;&quot;&quot;</span>
        <span class="c1"># å°„çº¿è¿½è¸ªæ¸…é™¤åŠ¨æ€éšœç¢ç‰©</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">range_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">ranges</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">range_val</span> <span class="o">&lt;</span> <span class="n">scan</span><span class="o">.</span><span class="n">range_max</span><span class="p">:</span>
                <span class="c1"># æ¸…é™¤å°„çº¿è·¯å¾„</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_ray</span><span class="p">(</span>
                    <span class="n">pose</span><span class="p">,</span> 
                    <span class="n">pose</span> <span class="o">+</span> <span class="n">range_val</span> <span class="o">*</span> <span class="n">angle_to_vector</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">angle_min</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">scan</span><span class="o">.</span><span class="n">angle_increment</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># æ ‡è®°ç»ˆç‚¹ä¸ºå ç”¨</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mark_occupied</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆå¹¶æ›´æ–°åˆ°åŸºç¡€åœ°å›¾&quot;&quot;&quot;</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">update</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">updates</span><span class="p">:</span>
            <span class="c1"># è´å¶æ–¯æ›´æ–°</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_update</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">merged</span>
</code></pre></div>

<h3 id="1135">11.3.5 åœ°å›¾æœåŠ¡æ¥å£</h3>
<p>æ ‡å‡†åœ°å›¾æœåŠ¡ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># åŠ è½½åœ°å›¾æœåŠ¡</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LoadMapService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_load_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># åŠ è½½æŒ‡å®šåœ°å›¾</span>
            <span class="n">map_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_map_from_file</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">map_url</span><span class="p">)</span>

            <span class="c1"># å‘å¸ƒåˆ°è¯é¢˜</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">publish_map</span><span class="p">(</span><span class="n">map_data</span><span class="p">)</span>

            <span class="c1"># è¿”å›ç»“æœ</span>
            <span class="n">response</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">LoadMap</span><span class="o">.</span><span class="n">Response</span><span class="o">.</span><span class="n">RESULT_SUCCESS</span>
            <span class="n">response</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">map_data</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">response</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">LoadMap</span><span class="o">.</span><span class="n">Response</span><span class="o">.</span><span class="n">RESULT_INVALID_MAP</span>

        <span class="k">return</span> <span class="n">response</span>

<span class="c1"># ä¿å­˜åœ°å›¾æœåŠ¡</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SaveMapService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_save_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># è·å–å½“å‰åœ°å›¾</span>
        <span class="n">current_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_map</span><span class="p">()</span>

        <span class="c1"># ä¿å­˜åˆ°æ–‡ä»¶</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span>
            <span class="n">request</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">current_map</span><span class="p">,</span>
            <span class="n">request</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
            <span class="n">request</span><span class="o">.</span><span class="n">free_thresh</span><span class="p">,</span>
            <span class="n">request</span><span class="o">.</span><span class="n">occupied_thresh</span>
        <span class="p">)</span>

        <span class="n">response</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div>

<h2 id="114">11.4 å¤šä¼ æ„Ÿå™¨èåˆå®šä½</h2>
<p>ç°ä»£æœºå™¨äººç³»ç»Ÿé€šå¸¸é›†æˆå¤šç§ä¼ æ„Ÿå™¨å®ç°é²æ£’å®šä½ï¼ŒåŒ…æ‹¬ IMUã€é‡Œç¨‹è®¡ã€æ¿€å…‰é›·è¾¾ã€è§†è§‰å’Œ GPS ç­‰ã€‚</p>
<h3 id="1141">11.4.1 ä¼ æ„Ÿå™¨ç‰¹æ€§åˆ†æ</h3>
<p>ä¸åŒä¼ æ„Ÿå™¨çš„äº’è¡¥ç‰¹æ€§ï¼š</p>
<p>| ä¼ æ„Ÿå™¨ | æ›´æ–°é¢‘ç‡ | ç²¾åº¦ç‰¹ç‚¹ | è¯¯å·®ç±»å‹ | é€‚ç”¨åœºæ™¯ |</p>
<table>
<thead>
<tr>
<th>ä¼ æ„Ÿå™¨</th>
<th>æ›´æ–°é¢‘ç‡</th>
<th>ç²¾åº¦ç‰¹ç‚¹</th>
<th>è¯¯å·®ç±»å‹</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>è½®å¼é‡Œç¨‹è®¡</td>
<td>10-100 Hz</td>
<td>çŸ­æœŸç²¾ç¡®</td>
<td>ç´¯ç§¯æ¼‚ç§»</td>
<td>å¹³æ»‘åœ°é¢</td>
</tr>
<tr>
<td>IMU</td>
<td>100-1000 Hz</td>
<td>é«˜é¢‘å“åº”</td>
<td>åç½®/æ¼‚ç§»</td>
<td>åŠ¨æ€è¿åŠ¨</td>
</tr>
<tr>
<td>æ¿€å…‰é›·è¾¾</td>
<td>10-40 Hz</td>
<td>é«˜ç²¾åº¦</td>
<td>ç¯å¢ƒä¾èµ–</td>
<td>ç»“æ„åŒ–ç¯å¢ƒ</td>
</tr>
<tr>
<td>è§†è§‰</td>
<td>10-60 Hz</td>
<td>ç‰¹å¾ä¸°å¯Œ</td>
<td>å…‰ç…§æ•æ„Ÿ</td>
<td>çº¹ç†ç¯å¢ƒ</td>
</tr>
<tr>
<td>GPS/RTK</td>
<td>1-10 Hz</td>
<td>å…¨å±€å®šä½</td>
<td>å¤šå¾„/é®æŒ¡</td>
<td>å®¤å¤–å¼€é˜”</td>
</tr>
</tbody>
</table>
<h3 id="1142-ekf">11.4.2 æ‰©å±•å¡å°”æ›¼æ»¤æ³¢ï¼ˆEKFï¼‰</h3>
<p>robot_localization åŒ…çš„ EKF å®ç°ï¼š</p>
<p><strong>çŠ¶æ€å‘é‡å®šä¹‰</strong></p>
<p>15 ç»´çŠ¶æ€å‘é‡ï¼š
$$
\mathbf{x} = [x, y, z, \phi, \theta, \psi, \dot{x}, \dot{y}, \dot{z}, \dot{\phi}, \dot{\theta}, \dot{\psi}, \ddot{x}, \ddot{y}, \ddot{z}]^T
$$</p>
<p><strong>é¢„æµ‹æ­¥éª¤</strong></p>
<p>è¿åŠ¨æ¨¡å‹ï¼š
$$
\mathbf{x}_k = f(\mathbf{x}_{k-1}, \mathbf{u}_k) + \mathbf{w}_k
$$</p>
<p>å…¶ä¸­ $f$ æ˜¯éçº¿æ€§çŠ¶æ€è½¬ç§»å‡½æ•°ï¼Œ$\mathbf{w}_k$ æ˜¯è¿‡ç¨‹å™ªå£°ã€‚</p>
<p>åæ–¹å·®é¢„æµ‹ï¼š
$$
\mathbf{P}_k^- = \mathbf{F}_k \mathbf{P}_{k-1} \mathbf{F}_k^T + \mathbf{Q}_k
$$</p>
<p><strong>æ›´æ–°æ­¥éª¤</strong></p>
<p>è§‚æµ‹æ¨¡å‹ï¼š
$$
\mathbf{z}_k = h(\mathbf{x}_k) + \mathbf{v}_k
$$</p>
<p>å¡å°”æ›¼å¢ç›Šï¼š
$$
\mathbf{K}_k = \mathbf{P}_k^- \mathbf{H}_k^T (\mathbf{H}_k \mathbf{P}_k^- \mathbf{H}_k^T + \mathbf{R}_k)^{-1}
$$</p>
<p>çŠ¶æ€æ›´æ–°ï¼š
$$
\mathbf{x}_k = \mathbf{x}_k^- + \mathbf{K}_k(\mathbf{z}_k - h(\mathbf{x}_k^-))
$$</p>
<h3 id="1143-robot_localization">11.4.3 robot_localization é…ç½®</h3>
<p><strong>EKF èŠ‚ç‚¹é…ç½®</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ekf_localization.yaml</span>
<span class="nt">ekf_filter_node</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># åŸºç¡€é…ç½®</span>
<span class="w">    </span><span class="nt">frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30.0</span>
<span class="w">    </span><span class="nt">sensor_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">two_d_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="c1"># åæ ‡ç³»</span>
<span class="w">    </span><span class="nt">map_frame</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">map</span>
<span class="w">    </span><span class="nt">odom_frame</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">odom</span>
<span class="w">    </span><span class="nt">base_link_frame</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base_link</span>
<span class="w">    </span><span class="nt">world_frame</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">odom</span>

<span class="w">    </span><span class="c1"># é‡Œç¨‹è®¡è¾“å…¥</span>
<span class="w">    </span><span class="nt">odom0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/wheel_odometry</span>
<span class="w">    </span><span class="nt">odom0_config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">   </span><span class="c1"># x, y, z</span>
<span class="w">                   </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">   </span><span class="c1"># roll, pitch, yaw</span>
<span class="w">                   </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">   </span><span class="c1"># vx, vy, vz</span>
<span class="w">                   </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="c1"># vroll, vpitch, vyaw</span>
<span class="w">                   </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">]</span><span class="w">   </span><span class="c1"># ax, ay, az</span>
<span class="w">    </span><span class="nt">odom0_differential</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">odom0_relative</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">    </span><span class="c1"># IMU è¾“å…¥</span>
<span class="w">    </span><span class="nt">imu0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/imu/data</span>
<span class="w">    </span><span class="nt">imu0_config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="c1"># x, y, z</span>
<span class="w">                  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">     </span><span class="c1"># roll, pitch, yaw</span>
<span class="w">                  </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="c1"># vx, vy, vz</span>
<span class="w">                  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">     </span><span class="c1"># vroll, vpitch, vyaw</span>
<span class="w">                  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">]</span><span class="w">     </span><span class="c1"># ax, ay, az</span>
<span class="w">    </span><span class="nt">imu0_differential</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">imu0_relative</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">imu0_remove_gravitational_acceleration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="c1"># æ¿€å…‰å®šä½è¾“å…¥</span>
<span class="w">    </span><span class="nt">pose0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/amcl_pose</span>
<span class="w">    </span><span class="nt">pose0_config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">   </span><span class="c1"># x, y, z</span>
<span class="w">                   </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="c1"># roll, pitch, yaw</span>
<span class="w">                   </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">   </span><span class="c1"># vx, vy, vz</span>
<span class="w">                   </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">   </span><span class="c1"># vroll, vpitch, vyaw</span>
<span class="w">                   </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">]</span><span class="w">   </span><span class="c1"># ax, ay, az</span>
<span class="w">    </span><span class="nt">pose0_differential</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">pose0_relative</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">    </span><span class="c1"># è¿‡ç¨‹å™ªå£°åæ–¹å·®</span>
<span class="w">    </span><span class="nt">process_noise_covariance</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">      </span><span class="nv">0.05</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.05</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.06</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.03</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.03</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.06</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.025</span><span class="p p-Indicator">,</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.025</span><span class="p p-Indicator">,</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.04</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.01</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.01</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.02</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.01</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.01</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="nv">0.015</span>
<span class="w">    </span><span class="p p-Indicator">]</span>
</code></pre></div>

<h3 id="1144-ukf">11.4.4 æ— è¿¹å¡å°”æ›¼æ»¤æ³¢ï¼ˆUKFï¼‰</h3>
<p>UKF é€šè¿‡ç¡®å®šæ€§é‡‡æ ·å¤„ç†éçº¿æ€§ï¼š</p>
<p><strong>Sigma ç‚¹ç”Ÿæˆ</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_sigma_points</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">lambda_</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">kappa</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span>

    <span class="c1"># æƒé‡è®¡ç®—</span>
    <span class="n">Wm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">Wc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">Wm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">lambda_</span><span class="p">)</span>
    <span class="n">Wc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">Wm</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">Wc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">lambda_</span><span class="p">)</span>

    <span class="c1"># Sigma ç‚¹</span>
    <span class="n">sigma_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="n">sigma_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>

    <span class="n">sqrt_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">sigma_points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">sqrt_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">sigma_points</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">sqrt_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">sigma_points</span><span class="p">,</span> <span class="n">Wm</span><span class="p">,</span> <span class="n">Wc</span>
</code></pre></div>

<p><strong>UKF æ›´æ–°</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UKF</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="c1"># ç”Ÿæˆ sigma ç‚¹</span>
        <span class="n">sigma_points</span><span class="p">,</span> <span class="n">Wm</span><span class="p">,</span> <span class="n">Wc</span> <span class="o">=</span> <span class="n">generate_sigma_points</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
        <span class="p">)</span>

        <span class="c1"># é€šè¿‡è¿åŠ¨æ¨¡å‹ä¼ æ’­</span>
        <span class="n">sigma_points_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motion_model</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">sigma_points</span>
        <span class="p">])</span>

        <span class="c1"># è®¡ç®—é¢„æµ‹å‡å€¼å’Œåæ–¹å·®</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Wm</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma_points_pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sigma_points</span><span class="p">)):</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">sigma_points_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">+=</span> <span class="n">Wc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sensor_model</span><span class="p">):</span>
        <span class="c1"># ç”Ÿæˆ sigma ç‚¹</span>
        <span class="n">sigma_points</span><span class="p">,</span> <span class="n">Wm</span><span class="p">,</span> <span class="n">Wc</span> <span class="o">=</span> <span class="n">generate_sigma_points</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
        <span class="p">)</span>

        <span class="c1"># é€šè¿‡è§‚æµ‹æ¨¡å‹ä¼ æ’­</span>
        <span class="n">z_sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">sensor_model</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">sigma_points</span>
        <span class="p">])</span>

        <span class="c1"># è®¡ç®—è§‚æµ‹é¢„æµ‹</span>
        <span class="n">z_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Wm</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_sigma</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># è®¡ç®—åæ–¹å·®</span>
        <span class="n">Pzz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">Pxz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sigma_points</span><span class="p">)):</span>
            <span class="n">dz</span> <span class="o">=</span> <span class="n">z_sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_pred</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">sigma_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="n">Pzz</span> <span class="o">+=</span> <span class="n">Wc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dz</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
            <span class="n">Pxz</span> <span class="o">+=</span> <span class="n">Wc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>

        <span class="c1"># å¡å°”æ›¼å¢ç›Š</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">Pxz</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Pzz</span><span class="p">)</span>

        <span class="c1"># çŠ¶æ€æ›´æ–°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">K</span> <span class="o">@</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">z_pred</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">-=</span> <span class="n">K</span> <span class="o">@</span> <span class="n">Pzz</span> <span class="o">@</span> <span class="n">K</span><span class="o">.</span><span class="n">T</span>
</code></pre></div>

<h3 id="1145">11.4.5 ä¼ æ„Ÿå™¨æ ‡å®š</h3>
<p><strong>IMU-é‡Œç¨‹è®¡æ ‡å®š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calibrate_imu_odometry</span><span class="p">(</span><span class="n">imu_data</span><span class="p">,</span> <span class="n">odom_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ ‡å®š IMU å’Œé‡Œç¨‹è®¡ä¹‹é—´çš„å¤–å‚&quot;&quot;&quot;</span>
    <span class="c1"># æ—¶é—´åŒæ­¥</span>
    <span class="n">imu_sync</span><span class="p">,</span> <span class="n">odom_sync</span> <span class="o">=</span> <span class="n">time_synchronize</span><span class="p">(</span>
        <span class="n">imu_data</span><span class="p">,</span> <span class="n">odom_data</span>
    <span class="p">)</span>

    <span class="c1"># æå–è§’é€Ÿåº¦</span>
    <span class="n">imu_angular_vel</span> <span class="o">=</span> <span class="n">imu_sync</span><span class="p">[</span><span class="s1">&#39;angular_velocity&#39;</span><span class="p">]</span>
    <span class="n">odom_angular_vel</span> <span class="o">=</span> <span class="n">compute_angular_velocity</span><span class="p">(</span><span class="n">odom_sync</span><span class="p">)</span>

    <span class="c1"># æœ€å°äºŒä¹˜æ ‡å®š</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span>
        <span class="n">imu_angular_vel</span><span class="p">,</span> <span class="n">odom_angular_vel</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># è®¡ç®—æ—¶é—´åç§»</span>
    <span class="n">correlation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span>
        <span class="n">imu_angular_vel</span><span class="p">,</span> <span class="n">odom_angular_vel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span>
    <span class="p">)</span>
    <span class="n">time_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">correlation</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">imu_angular_vel</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">scale</span><span class="p">,</span> <span class="n">time_offset</span>
</code></pre></div>

<p><strong>æ¿€å…‰-IMU æ ‡å®š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># å¤–å‚æ ‡å®šç»“æœ</span>
<span class="nt">lidar_imu_extrinsics</span><span class="p">:</span>
<span class="w">  </span><span class="nt">translation</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.15</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.08</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [x, y, z]</span>
<span class="w">  </span><span class="nt">rotation</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">]</span><span class="w">       </span><span class="c1"># [roll, pitch, yaw]</span>
<span class="w">  </span><span class="nt">time_offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w">                </span><span class="c1"># ç§’</span>
</code></pre></div>

<h3 id="1146">11.4.6 æ•…éšœæ£€æµ‹ä¸æ¢å¤</h3>
<p>ä¼ æ„Ÿå™¨æ•…éšœæ£€æµ‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SensorFaultDetector</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chi2_threshold</span> <span class="o">=</span> <span class="mf">9.21</span>  <span class="c1"># 95% ç½®ä¿¡åº¦ï¼Œ3è‡ªç”±åº¦</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">innovation_window</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_innovation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">innovation</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é©¬æ°è·ç¦»æ£€éªŒ&quot;&quot;&quot;</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">innovation</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">@</span> <span class="n">innovation</span>
        <span class="k">return</span> <span class="n">chi2</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">chi2_threshold</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_sensor_health</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sensor_name</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¼ æ„Ÿå™¨å¥åº·æ£€æŸ¥&quot;&quot;&quot;</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data_rate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_data_rate</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="s1">&#39;range_valid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_range</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="s1">&#39;noise_level&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_noise</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="s1">&#39;consistency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_consistency</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">checks</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_sensor_failure</span><span class="p">(</span><span class="n">sensor_name</span><span class="p">,</span> <span class="n">checks</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_sensor_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sensor_name</span><span class="p">,</span> <span class="n">failures</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ•…éšœå¤„ç†ç­–ç•¥&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sensor_name</span> <span class="o">==</span> <span class="s1">&#39;gps&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">failures</span><span class="p">[</span><span class="s1">&#39;data_rate&#39;</span><span class="p">]:</span>
            <span class="c1"># GPS ä¿¡å·ä¸¢å¤±ï¼Œåˆ‡æ¢åˆ°çº¯é‡Œç¨‹è®¡/IMU</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_dead_reckoning</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">sensor_name</span> <span class="o">==</span> <span class="s1">&#39;imu&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">failures</span><span class="p">[</span><span class="s1">&#39;noise_level&#39;</span><span class="p">]:</span>
            <span class="c1"># IMU å™ªå£°è¿‡å¤§ï¼Œé™ä½æƒé‡</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reduce_sensor_weight</span><span class="p">(</span><span class="s1">&#39;imu&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div>

<h2 id="amazon">äº§ä¸šæ¡ˆä¾‹ç ”ç©¶ï¼šAmazon ä»“åº“æœºå™¨äººå¤§è§„æ¨¡å®šä½</h2>
<p>Amazon Roboticsï¼ˆå‰ Kiva Systemsï¼‰åœ¨å…¨çƒæ•°ç™¾ä¸ªé…é€ä¸­å¿ƒéƒ¨ç½²äº†è¶…è¿‡ 50 ä¸‡å°è‡ªä¸»ç§»åŠ¨æœºå™¨äººï¼ˆAMRï¼‰ï¼Œå®ç°äº†ä»“åº“ç‰©æµçš„é©å‘½æ€§å˜é©ã€‚</p>
<h3 id="_1">ç³»ç»Ÿæ¶æ„</h3>
<p><strong>åˆ†å±‚å®šä½ç³»ç»Ÿ</strong></p>
<div class="codehilite"><pre><span></span><code>å…¨å±€å±‚ï¼ˆFleet Managerï¼‰
â”œâ”€â”€ é›†ä¸­å¼åœ°å›¾ç®¡ç†
â”œâ”€â”€ å…¨å±€è·¯å¾„è§„åˆ’
â””â”€â”€ ä»»åŠ¡åˆ†é…

åŒºåŸŸå±‚ï¼ˆZone Controllerï¼‰
â”œâ”€â”€ å±€éƒ¨åœ°å›¾æ›´æ–°
â”œâ”€â”€ åŒºåŸŸå†…åè°ƒ
â””â”€â”€ æ‹¥å¡ç®¡ç†

æœºå™¨äººå±‚ï¼ˆRobotï¼‰
â”œâ”€â”€ æ¿è½½å®šä½ï¼ˆAMCL+EKFï¼‰
â”œâ”€â”€ å±€éƒ¨é¿éšœ
â””â”€â”€ æ‰§è¡Œæ§åˆ¶
</code></pre></div>

<h3 id="_2">æŠ€æœ¯æ–¹æ¡ˆ</h3>
<ol>
<li><strong>äºŒç»´ç è¾…åŠ©å®šä½</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FiducialLocalization</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fiducial_map</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># ID -&gt; (x, y, theta)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_fiducial</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dead_reckoning_distance</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fiducial_detection</span><span class="p">,</span> <span class="n">odometry</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fiducial_detection</span><span class="p">:</span>
            <span class="c1"># ç»å¯¹å®šä½æ ¡æ­£</span>
            <span class="n">fid_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fiducial_map</span><span class="p">[</span><span class="n">fiducial_detection</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">correct_pose</span><span class="p">(</span><span class="n">fid_pose</span><span class="p">,</span> <span class="n">fiducial_detection</span><span class="o">.</span><span class="n">relative_pose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_fiducial</span> <span class="o">=</span> <span class="n">fiducial_detection</span><span class="o">.</span><span class="n">id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dead_reckoning_distance</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># é‡Œç¨‹è®¡æ¨ç®—</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dead_reckoning_update</span><span class="p">(</span><span class="n">odometry</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dead_reckoning_distance</span> <span class="o">+=</span> <span class="n">odometry</span><span class="o">.</span><span class="n">distance</span>

        <span class="c1"># ä¸ç¡®å®šæ€§ç®¡ç†</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dead_reckoning_distance</span> <span class="o">&gt;</span> <span class="mf">5.0</span><span class="p">:</span>  <span class="c1"># 5ç±³</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_fiducial_scan</span><span class="p">()</span>
</code></pre></div>

<ol start="2">
<li><strong>å¤šæœºå™¨äººåä½œå®šä½</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1"># åä½œé…ç½®</span>
<span class="nt">cooperative_localization</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">max_range</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0</span><span class="w">  </span><span class="c1"># ç±³</span>
<span class="w">  </span><span class="nt">min_observations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">  </span><span class="c1"># ç›¸å¯¹è§‚æµ‹</span>
<span class="w">  </span><span class="nt">robot_detection</span><span class="p">:</span>
<span class="w">    </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uwb_ranging&quot;</span><span class="w">  </span><span class="c1"># æˆ– &quot;visual_markers&quot;</span>
<span class="w">    </span><span class="nt">frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>

<span class="w">  </span><span class="c1"># ä¿¡æ¯èåˆ</span>
<span class="w">  </span><span class="nt">fusion</span><span class="p">:</span>
<span class="w">    </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;distributed_ekf&quot;</span>
<span class="w">    </span><span class="nt">communication</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_mesh&quot;</span>
</code></pre></div>

<h3 id="_3">æ€§èƒ½æŒ‡æ ‡</h3>
<p>| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®é™…è¾¾æˆ |</p>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>ç›®æ ‡å€¼</th>
<th>å®é™…è¾¾æˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®šä½ç²¾åº¦</td>
<td>&lt; 5cm</td>
<td>2-3cm</td>
</tr>
<tr>
<td>æ›´æ–°é¢‘ç‡</td>
<td>&gt; 10Hz</td>
<td>20Hz</td>
</tr>
<tr>
<td>åˆå§‹åŒ–æ—¶é—´</td>
<td>&lt; 10s</td>
<td>5-8s</td>
</tr>
<tr>
<td>ç³»ç»Ÿå¯ç”¨æ€§</td>
<td>&gt; 99.9%</td>
<td>99.95%</td>
</tr>
<tr>
<td>å•ä»“åº“æœºå™¨äººæ•°</td>
<td>1000+</td>
<td>3000+</td>
</tr>
</tbody>
</table>
<h3 id="_4">å…³é”®ä¼˜åŒ–</h3>
<ol>
<li><strong>åœ°å›¾å‹ç¼©ä¸åˆ†å‘</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MapDistribution</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_map</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># å®Œæ•´åœ°å›¾</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zone_maps</span> <span class="o">=</span> <span class="p">{}</span>     <span class="c1"># åˆ†åŒºåœ°å›¾</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_robot_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot_id</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆä»»åŠ¡ç›¸å…³çš„ç²¾ç®€åœ°å›¾&quot;&quot;&quot;</span>
        <span class="c1"># ç¡®å®šæ´»åŠ¨åŒºåŸŸ</span>
        <span class="n">active_zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_task_zones</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

        <span class="c1"># æå–ç›¸å…³åœ°å›¾</span>
        <span class="n">robot_map</span> <span class="o">=</span> <span class="n">OccupancyGrid</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">active_zones</span><span class="p">:</span>
            <span class="n">robot_map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zone_maps</span><span class="p">[</span><span class="n">zone</span><span class="p">])</span>

        <span class="c1"># å‹ç¼©ä¼ è¾“</span>
        <span class="n">compressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_map</span><span class="p">(</span><span class="n">robot_map</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">compressed</span>
</code></pre></div>

<ol start="2">
<li><strong>å®šä½å¤±è´¥æ¢å¤</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LocalizationRecovery</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_behaviors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotate_in_place</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_to_open_space</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_assistance</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å®šä½ä¸¢å¤±å¤„ç†æµç¨‹&quot;&quot;&quot;</span>
        <span class="c1"># 1. åœæ­¢ç§»åŠ¨</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_robot</span><span class="p">()</span>

        <span class="c1"># 2. å°è¯•æ¢å¤</span>
        <span class="k">for</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_behaviors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">behavior</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># 3. è¯·æ±‚äººå·¥ä»‹å…¥</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_operator</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>

<h3 id="_5">è¸©å‘ä¸è§£å†³</h3>
<p><strong>é—®é¢˜ 1ï¼šWiFi å¹²æ‰°å¯¼è‡´é€šä¿¡å»¶è¿Ÿ</strong></p>
<ul>
<li>ç—‡çŠ¶ï¼šé«˜å¯†åº¦éƒ¨ç½²åŒºåŸŸå®šä½è·³å˜</li>
<li>è§£å†³ï¼š5GHz é¢‘æ®µ + å®šå‘å¤©çº¿ + æ—¶é—´æ§½åˆ†é…</li>
</ul>
<p><strong>é—®é¢˜ 2ï¼šåœ°é¢æ ‡è®°ç£¨æŸ</strong></p>
<ul>
<li>ç—‡çŠ¶ï¼šäºŒç»´ç è¯†åˆ«ç‡ä¸‹é™</li>
<li>è§£å†³ï¼šå†—ä½™æ ‡è®° + é¢„æµ‹æ€§ç»´æŠ¤ + æ¿€å…‰ SLAM å¤‡ä»½</li>
</ul>
<p><strong>é—®é¢˜ 3ï¼šåŠ¨æ€éšœç¢ç‰©ï¼ˆäººå‘˜ï¼‰</strong></p>
<ul>
<li>ç—‡çŠ¶ï¼šé¢‘ç¹é‡å®šä½</li>
<li>è§£å†³ï¼šäººå‘˜æ£€æµ‹ + é¢„æµ‹è½¨è¿¹ + å®‰å…¨åŒºåŸŸ</li>
</ul>
<h2 id="graphslam">é«˜çº§è¯é¢˜ï¼šGraphSLAM ä¸å› å­å›¾ä¼˜åŒ–</h2>
<h3 id="graphslam_1">GraphSLAM åŸç†</h3>
<p>GraphSLAM å°† SLAM é—®é¢˜è¡¨ç¤ºä¸ºå› å­å›¾ï¼Œé€šè¿‡æœ€å¤§åéªŒä¼°è®¡ï¼ˆMAPï¼‰æ±‚è§£ï¼š</p>
<p>$$
X^*, L^* = \arg\max_{X,L} P(X, L | Z, U)
$$</p>
<p>å› å­å›¾è¡¨ç¤ºï¼š</p>
<ul>
<li>å˜é‡èŠ‚ç‚¹ï¼šæœºå™¨äººä½å§¿ $x_i$ï¼Œåœ°æ ‡ä½ç½® $l_j$</li>
<li>å› å­èŠ‚ç‚¹ï¼šè¿åŠ¨çº¦æŸ $f_u$ï¼Œè§‚æµ‹çº¦æŸ $f_z$</li>
</ul>
<h3 id="isam2">å¢é‡å¼å¹³æ»‘ä¸å»ºå›¾ï¼ˆiSAM2ï¼‰</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">iSAM2</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bayes_tree</span> <span class="o">=</span> <span class="n">BayesTree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># å½“å‰ä¼°è®¡</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¢é‡æ·»åŠ å› å­&quot;&quot;&quot;</span>
        <span class="c1"># è¯†åˆ«å—å½±å“çš„å˜é‡</span>
        <span class="n">affected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_affected_cliques</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>

        <span class="c1"># é‡æ–°çº¿æ€§åŒ–</span>
        <span class="k">for</span> <span class="n">clique</span> <span class="ow">in</span> <span class="n">affected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relinearize</span><span class="p">(</span><span class="n">clique</span><span class="p">)</span>

        <span class="c1"># éƒ¨åˆ†æ¶ˆå…ƒ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partial_elimination</span><span class="p">(</span><span class="n">affected</span><span class="p">)</span>

        <span class="c1"># åå‘æ›¿æ¢æ›´æ–°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">back_substitution</span><span class="p">()</span>
</code></pre></div>

<h3 id="g2o">g2o ä¼˜åŒ–æ¡†æ¶é›†æˆ</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// g2o å›¾ä¼˜åŒ–ç¤ºä¾‹</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;g2o/core/sparse_optimizer.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;g2o/core/block_solver.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;g2o/solvers/eigen/linear_solver_eigen.h&gt;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GraphSLAMOptimizer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">g2o</span><span class="o">::</span><span class="n">SparseOptimizer</span><span class="w"> </span><span class="n">optimizer</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">optimize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// é…ç½®æ±‚è§£å™¨</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">linearSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span>
<span class="w">            </span><span class="n">g2o</span><span class="o">::</span><span class="n">LinearSolverEigen</span><span class="o">&lt;</span><span class="n">g2o</span><span class="o">::</span><span class="n">BlockSolver_6_3</span><span class="o">::</span><span class="n">PoseMatrixType</span><span class="o">&gt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">blockSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span>
<span class="w">            </span><span class="n">g2o</span><span class="o">::</span><span class="n">BlockSolver_6_3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">linearSolver</span><span class="p">));</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">g2o</span><span class="o">::</span><span class="n">OptimizationAlgorithmLevenberg</span><span class="p">(</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">blockSolver</span><span class="p">));</span>

<span class="w">        </span><span class="n">optimizer</span><span class="p">.</span><span class="n">setAlgorithm</span><span class="p">(</span><span class="n">solver</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// æ·»åŠ é¡¶ç‚¹ï¼ˆä½å§¿ï¼‰</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pose</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">poses</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">vertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">g2o</span><span class="o">::</span><span class="n">VertexSE2</span><span class="p">();</span>
<span class="w">            </span><span class="n">vertex</span><span class="o">-&gt;</span><span class="n">setId</span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>
<span class="w">            </span><span class="n">vertex</span><span class="o">-&gt;</span><span class="n">setEstimate</span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">to_se2</span><span class="p">());</span>
<span class="w">            </span><span class="n">optimizer</span><span class="p">.</span><span class="n">addVertex</span><span class="p">(</span><span class="n">vertex</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// æ·»åŠ è¾¹ï¼ˆçº¦æŸï¼‰</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">constraints</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">g2o</span><span class="o">::</span><span class="n">EdgeSE2</span><span class="p">();</span>
<span class="w">            </span><span class="n">edge</span><span class="o">-&gt;</span><span class="n">setVertex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">optimizer</span><span class="p">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">constraint</span><span class="p">.</span><span class="n">from</span><span class="p">));</span>
<span class="w">            </span><span class="n">edge</span><span class="o">-&gt;</span><span class="n">setVertex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">optimizer</span><span class="p">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">constraint</span><span class="p">.</span><span class="n">to</span><span class="p">));</span>
<span class="w">            </span><span class="n">edge</span><span class="o">-&gt;</span><span class="n">setMeasurement</span><span class="p">(</span><span class="n">constraint</span><span class="p">.</span><span class="n">transform</span><span class="p">);</span>
<span class="w">            </span><span class="n">edge</span><span class="o">-&gt;</span><span class="n">setInformation</span><span class="p">(</span><span class="n">constraint</span><span class="p">.</span><span class="n">information</span><span class="p">);</span>
<span class="w">            </span><span class="n">optimizer</span><span class="p">.</span><span class="n">addEdge</span><span class="p">(</span><span class="n">edge</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// æ‰§è¡Œä¼˜åŒ–</span>
<span class="w">        </span><span class="n">optimizer</span><span class="p">.</span><span class="n">initializeOptimization</span><span class="p">();</span>
<span class="w">        </span><span class="n">optimizer</span><span class="p">.</span><span class="n">optimize</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="slam">åˆ†å¸ƒå¼ SLAM</h3>
<p>å¤šæœºå™¨äººåä½œ SLAM ç®—æ³•ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DistributedSLAM</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot_id</span> <span class="o">=</span> <span class="n">robot_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_graph</span> <span class="o">=</span> <span class="n">FactorGraph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shared_variables</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">consensus_optimization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ADMM å…±è¯†ä¼˜åŒ–&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">):</span>
            <span class="c1"># æœ¬åœ°ä¼˜åŒ–</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_update</span><span class="p">()</span>

            <span class="c1"># äº¤æ¢å…±äº«å˜é‡</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exchange_shared_variables</span><span class="p">()</span>

            <span class="c1"># æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ›´æ–°</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_dual_variables</span><span class="p">()</span>

            <span class="c1"># æ£€æŸ¥æ”¶æ•›</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_convergence</span><span class="p">():</span>
                <span class="k">break</span>
</code></pre></div>

<h3 id="slam_1">è¯­ä¹‰ SLAM</h3>
<p>ç»“åˆè¯­ä¹‰ä¿¡æ¯çš„ SLAMï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SemanticSLAM</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometric_map</span> <span class="o">=</span> <span class="n">OccupancyGrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semantic_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_detector</span> <span class="o">=</span> <span class="n">YOLOv8</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">pose</span><span class="p">):</span>
        <span class="c1"># ç›®æ ‡æ£€æµ‹</span>
        <span class="n">detections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_detector</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># 3D é‡å»º</span>
        <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">detections</span><span class="p">:</span>
            <span class="n">object_3d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backproject</span><span class="p">(</span><span class="n">det</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">pose</span><span class="p">)</span>

            <span class="c1"># æ•°æ®å…³è”</span>
            <span class="n">matched</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_association</span><span class="p">(</span><span class="n">object_3d</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">matched</span><span class="p">:</span>
                <span class="c1"># æ›´æ–°å·²æœ‰å¯¹è±¡</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_object</span><span class="p">(</span><span class="n">matched</span><span class="p">,</span> <span class="n">object_3d</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># æ·»åŠ æ–°å¯¹è±¡</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="n">object_3d</span><span class="p">)</span>

        <span class="c1"># è¯­ä¹‰çº¦æŸä¼˜åŒ–</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimize_with_semantics</span><span class="p">()</span>
</code></pre></div>

<h3 id="_6">æ¨èè®ºæ–‡</h3>
<ol>
<li>
<p><strong>Grisetti et al., 2010</strong> - "A Tutorial on Graph-Based SLAM"
   - GraphSLAM ç†è®ºåŸºç¡€</p>
</li>
<li>
<p><strong>Kaess et al., 2012</strong> - "iSAM2: Incremental Smoothing and Mapping Using the Bayes Tree"
   - å¢é‡å¼ä¼˜åŒ–æ–¹æ³•</p>
</li>
<li>
<p><strong>Rosinol et al., 2020</strong> - "Kimera: Real-Time Metric-Semantic SLAM"
   - è¯­ä¹‰ SLAM æœ€æ–°è¿›å±•</p>
</li>
</ol>
<h3 id="_7">å¼€æºé¡¹ç›®</h3>
<ul>
<li><strong>GTSAM</strong>: Georgia Tech Smoothing and Mapping library</li>
<li><strong>g2o</strong>: General Graph Optimization</li>
<li><strong>Cartographer</strong>: Google çš„å®æ—¶ 2D/3D SLAM</li>
<li><strong>ORB-SLAM3</strong>: è§†è§‰/è§†è§‰-æƒ¯æ€§ SLAM</li>
</ul>
<h2 id="_8">æœ¬ç« å°ç»“</h2>
<p>æœ¬ç« ç³»ç»Ÿä»‹ç»äº† ROS2 ä¸­çš„ SLAM ä¸å®šä½æŠ€æœ¯æ ˆï¼š</p>
<p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong></p>
<ul>
<li>AMCL ç²’å­æ»¤æ³¢å®šä½ï¼šè¿åŠ¨æ¨¡å‹ã€è§‚æµ‹æ¨¡å‹ã€è‡ªé€‚åº”ç²’å­æ•°</li>
<li>slam_toolbox å›¾ä¼˜åŒ–ï¼šæ‰«æåŒ¹é…ã€å›ç¯æ£€æµ‹ã€åœ°å›¾åºåˆ—åŒ–</li>
<li>åœ°å›¾æœåŠ¡å™¨ï¼šå¤šå±‚åœ°å›¾ã€åŠ¨æ€æ›´æ–°ã€æœåŠ¡æ¥å£</li>
<li>å¤šä¼ æ„Ÿå™¨èåˆï¼šEKF/UKFã€robot_localizationã€ä¼ æ„Ÿå™¨æ ‡å®š</li>
</ul>
<p><strong>å…³é”®å…¬å¼</strong></p>
<ul>
<li>ç²’å­æ»¤æ³¢åéªŒï¼š$\text{Bel}(x_t) \approx \{x_t^{[i]}, w_t^{[i]}\}_{i=1}^N$</li>
<li>å›¾ä¼˜åŒ–ç›®æ ‡ï¼š$x^* = \arg\min_x \sum_{ij} e_{ij}^T \Omega_{ij} e_{ij}$</li>
<li>EKF æ›´æ–°ï¼š$\mathbf{x}_k = \mathbf{x}_k^- + \mathbf{K}_k(\mathbf{z}_k - h(\mathbf{x}_k^-))$</li>
</ul>
<p><strong>å®è·µè¦ç‚¹</strong></p>
<ul>
<li>æ ¹æ®ç¯å¢ƒç‰¹å¾é€‰æ‹©åˆé€‚çš„å®šä½æ–¹æ³•</li>
<li>å¤šä¼ æ„Ÿå™¨èåˆæé«˜é²æ£’æ€§</li>
<li>åˆç†é…ç½®å‚æ•°å¹³è¡¡ç²¾åº¦ä¸è®¡ç®—é‡</li>
<li>å®æ–½æ•…éšœæ£€æµ‹ä¸æ¢å¤æœºåˆ¶</li>
</ul>
<h2 id="_9">ç»ƒä¹ é¢˜</h2>
<h3 id="_10">åŸºç¡€é¢˜</h3>
<ol>
<li><strong>AMCL å‚æ•°è°ƒä¼˜</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>åœºæ™¯ï¼šä»“åº“ç¯å¢ƒï¼Œé¢ç§¯ 5000mÂ²ï¼Œæœºå™¨äººæœ€å¤§é€Ÿåº¦ 2m/s
è¦æ±‚ï¼šé…ç½® AMCL å‚æ•°å®ç° &lt;10cm å®šä½ç²¾åº¦
</code></pre></div>

<details>
<summary>æç¤º</summary>
<p>è€ƒè™‘ç²’å­æ•°é‡ã€æ›´æ–°é¢‘ç‡ã€è¿åŠ¨å™ªå£°å‚æ•°çš„å¹³è¡¡</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>å…³é”®å‚æ•°é…ç½®ï¼š</p>
<ul>
<li>min_particles: 500ï¼ˆä¿è¯ç²¾åº¦ï¼‰</li>
<li>max_particles: 2000ï¼ˆé™åˆ¶è®¡ç®—ï¼‰</li>
<li>update_min_d: 0.1ï¼ˆé¢‘ç¹æ›´æ–°ï¼‰</li>
<li>update_min_a: 0.1</li>
<li>alpha1-4: 0.1, 0.1, 0.15, 0.1ï¼ˆæ ¹æ®é‡Œç¨‹è®¡ç²¾åº¦ï¼‰</li>
<li>laser_sigma_hit: 0.1ï¼ˆæ¿€å…‰ç²¾åº¦é«˜ï¼‰</li>
<li>resample_interval: 1</li>
</ul>
</details>
<ol start="2">
<li><strong>å›ç¯æ£€æµ‹å®ç°</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>ä»»åŠ¡ï¼šè®¾è®¡å›ç¯æ£€æµ‹ç®—æ³•çš„åˆ¤æ–­æ¡ä»¶
è¾“å…¥ï¼šå½“å‰ä½å§¿ã€å†å²è½¨è¿¹ã€æ¿€å…‰æ‰«æ
è¾“å‡ºï¼šæ˜¯å¦æ£€æµ‹åˆ°å›ç¯
</code></pre></div>

<details>
<summary>æç¤º</summary>
<p>ç»¼åˆè€ƒè™‘ç©ºé—´è·ç¦»ã€æ—¶é—´é—´éš”ã€æ‰«æåŒ¹é…å¾—åˆ†</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>å›ç¯åˆ¤æ–­æ¡ä»¶ï¼š</p>
<ol>
<li>ç©ºé—´è·ç¦» &lt; 2m</li>
<li>æ—¶é—´é—´éš” &gt; 30s</li>
<li>æ‰«æåŒ¹é…å¾—åˆ† &gt; 0.8</li>
<li>åŒ¹é…åæ–¹å·®ç‰¹å¾å€¼ &lt; é˜ˆå€¼</li>
<li>è¿ç»­ N å¸§ç¡®è®¤</li>
</ol>
</details>
<ol start="3">
<li><strong>åœ°å›¾æ ¼å¼è½¬æ¢</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>éœ€æ±‚ï¼šå°† PGM æ ¼å¼åœ°å›¾è½¬æ¢ä¸º nav_msgs/OccupancyGrid
è¾“å…¥ï¼šmap.pgm (2048x2048), map.yaml
è¾“å‡ºï¼šOccupancyGrid æ¶ˆæ¯
</code></pre></div>

<details>
<summary>æç¤º</summary>
<p>æ³¨æ„åæ ‡ç³»è½¬æ¢å’Œå ç”¨å€¼æ˜ å°„</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>è½¬æ¢æ­¥éª¤ï¼š</p>
<ol>
<li>è¯»å– PGM å›¾åƒå’Œ YAML é…ç½®</li>
<li>æ ¹æ® negate å‚æ•°åè½¬é¢œè‰²</li>
<li>æ˜ å°„åƒç´ å€¼åˆ°å ç”¨æ¦‚ç‡ï¼š
   - ç™½è‰²(255) â†’ 0 (free)
   - é»‘è‰²(0) â†’ 100 (occupied)
   - ç°è‰² â†’ -1 (unknown)</li>
<li>è®¾ç½® origin å’Œ resolution</li>
<li>å¡«å…… OccupancyGrid æ¶ˆæ¯</li>
</ol>
</details>
<ol start="4">
<li><strong>EKF ä¼ æ„Ÿå™¨é…ç½®</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>ä¼ æ„Ÿå™¨ï¼šIMU(100Hz)ã€è½®å¼é‡Œç¨‹è®¡(20Hz)ã€GPS(1Hz)
ç›®æ ‡ï¼šå®¤å¤–å¯¼èˆªï¼Œç²¾åº¦è¦æ±‚ 0.5m
</code></pre></div>

<details>
<summary>æç¤º</summary>
<p>è€ƒè™‘ä¼ æ„Ÿå™¨æ›´æ–°é¢‘ç‡å’Œæµ‹é‡ç»´åº¦</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>é…ç½®ç­–ç•¥ï¼š</p>
<ul>
<li>IMU: ä½¿ç”¨è§’åº¦ã€è§’é€Ÿåº¦ã€åŠ é€Ÿåº¦</li>
<li>é‡Œç¨‹è®¡: ä½¿ç”¨çº¿é€Ÿåº¦ã€è§’é€Ÿåº¦</li>
<li>GPS: ä½¿ç”¨ç»å¯¹ä½ç½® x, y</li>
<li>EKF é¢‘ç‡: 30Hz</li>
<li>two_d_mode: trueï¼ˆå¹³é¢è¿åŠ¨ï¼‰</li>
<li>è¿‡ç¨‹å™ªå£°: æ ¹æ®åœ°å½¢è°ƒæ•´</li>
</ul>
</details>
<h3 id="_11">æŒ‘æˆ˜é¢˜</h3>
<ol start="5">
<li><strong>å¤šæœºå™¨äººåä½œå®šä½</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>åœºæ™¯ï¼š3 ä¸ªæœºå™¨äººåœ¨åŒä¸€ç¯å¢ƒä¸­è¿è¡Œ
è¦æ±‚ï¼šè®¾è®¡ç›¸å¯¹è§‚æµ‹å’Œä¿¡æ¯èåˆæ–¹æ¡ˆ
çº¦æŸï¼šé€šä¿¡å¸¦å®½ &lt; 1MB/s
</code></pre></div>

<details>
<summary>æç¤º</summary>
<p>è€ƒè™‘åˆ†å¸ƒå¼æ¶æ„ã€æ•°æ®å‹ç¼©ã€æ—¶é—´åŒæ­¥</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>è®¾è®¡æ–¹æ¡ˆï¼š</p>
<ol>
<li>
<p>ç›¸å¯¹è§‚æµ‹ï¼š
   - UWB æµ‹è·ï¼ˆ10Hzï¼‰
   - è§†è§‰æ ‡è®°è¯†åˆ«
   - æ¿€å…‰ç‰¹å¾åŒ¹é…</p>
</li>
<li>
<p>ä¿¡æ¯èåˆï¼š
   - åˆ†å¸ƒå¼ EKF
   - å…±äº«åœ°å›¾ç‰¹å¾ç‚¹
   - åæ–¹å·®äº¤é›†ç®—æ³•</p>
</li>
<li>
<p>é€šä¿¡ä¼˜åŒ–ï¼š
   - å¢é‡åœ°å›¾æ›´æ–°
   - ç‰¹å¾ç‚¹å‹ç¼©
   - äº‹ä»¶è§¦å‘é€šä¿¡</p>
</li>
</ol>
</details>
<ol start="6">
<li><strong>åŠ¨æ€ç¯å¢ƒ SLAM</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>é—®é¢˜ï¼šäººå‘˜å¯†é›†ç¯å¢ƒä¸­çš„å»ºå›¾
æŒ‘æˆ˜ï¼š50% æ¿€å…‰ç‚¹å‡»ä¸­åŠ¨æ€ç‰©ä½“
è®¾è®¡ï¼šé²æ£’çš„ SLAM ç®—æ³•
</code></pre></div>

<details>
<summary>æç¤º</summary>
<p>åŠ¨é™æ€ç‚¹åˆ†ç¦»ã€æ¦‚ç‡å ç”¨æ›´æ–°ã€é•¿æœŸåœ°å›¾ç»´æŠ¤</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>
<p>åŠ¨æ€ç‚¹è¿‡æ»¤ï¼š
   - åŸºäºå ç”¨ä¸€è‡´æ€§
   - é€Ÿåº¦é˜ˆå€¼åˆ¤æ–­
   - æœºå™¨å­¦ä¹ åˆ†ç±»</p>
</li>
<li>
<p>åœ°å›¾æ›´æ–°ç­–ç•¥ï¼š
   - çŸ­æœŸ/é•¿æœŸåœ°å›¾åˆ†ç¦»
   - è´å¶æ–¯å ç”¨æ›´æ–°
   - è¡°å‡å› å­</p>
</li>
<li>
<p>å®šä½è¡¥å¿ï¼š
   - å¢åŠ é™æ€ç‰¹å¾æƒé‡
   - ä½¿ç”¨å¤©èŠ±æ¿ç‰¹å¾
   - IMU è¾…åŠ©</p>
</li>
</ol>
</details>
<ol start="7">
<li><strong>å®šä½å¤±è´¥è¯Šæ–­</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>ç—‡çŠ¶ï¼šæœºå™¨äººä½ç½®çªå˜ï¼Œç²’å­äº‘å‘æ•£
ä»»åŠ¡ï¼šè®¾è®¡è‡ªåŠ¨è¯Šæ–­å’Œæ¢å¤ç³»ç»Ÿ
</code></pre></div>

<details>
<summary>æç¤º</summary>
<p>ç›‘æ§å¤šä¸ªæŒ‡æ ‡ï¼Œåˆ†çº§æ¢å¤ç­–ç•¥</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>è¯Šæ–­ç³»ç»Ÿï¼š</p>
<ol>
<li>
<p>ç›‘æ§æŒ‡æ ‡ï¼š
   - ç²’å­äº‘åæ–¹å·®
   - æ¿€å…‰åŒ¹é…å¾—åˆ†
   - é‡Œç¨‹è®¡-æ¿€å…‰ä¸€è‡´æ€§
   - æœ‰æ•ˆç²’å­æ•°</p>
</li>
<li>
<p>æ•…éšœåˆ†ç±»ï¼š
   - ç»‘æ¶é—®é¢˜
   - ä¼ æ„Ÿå™¨æ•…éšœ
   - åœ°å›¾ä¸åŒ¹é…</p>
</li>
<li>
<p>æ¢å¤ç­–ç•¥ï¼š
   - Level 1: å¢åŠ ç²’å­æ•°
   - Level 2: å…¨å±€é‡å®šä½
   - Level 3: åˆ‡æ¢å¤‡ç”¨ä¼ æ„Ÿå™¨
   - Level 4: å®‰å…¨åœæ­¢</p>
</li>
</ol>
</details>
<ol start="8">
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>å½“å‰ï¼šSLAM å ç”¨ 80% CPUï¼Œå»ºå›¾å»¶è¿Ÿ 2s
ç›®æ ‡ï¼šé™è‡³ 40% CPUï¼Œå®æ—¶å»ºå›¾
ç¡¬ä»¶ï¼šARM Cortex-A72 å››æ ¸
</code></pre></div>

<details>
<summary>æç¤º</summary>
<p>ç®—æ³•ä¼˜åŒ–ã€å¹¶è¡Œè®¡ç®—ã€å‚æ•°è°ƒæ•´</p>
</details>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>ä¼˜åŒ–æ–¹æ¡ˆï¼š</p>
<ol>
<li>
<p>ç®—æ³•å±‚ï¼š
   - é™é‡‡æ ·æ¿€å…‰ç‚¹
   - å‡å°‘æœç´¢èŒƒå›´
   - è‡ªé€‚åº”åˆ†è¾¨ç‡</p>
</li>
<li>
<p>å®ç°å±‚ï¼š
   - SIMD æŒ‡ä»¤ä¼˜åŒ–
   - å¤šçº¿ç¨‹æ‰«æåŒ¹é…
   - GPU åŠ é€Ÿï¼ˆå¦‚å¯ç”¨ï¼‰</p>
</li>
<li>
<p>ç³»ç»Ÿå±‚ï¼š
   - é™ä½åœ°å›¾æ›´æ–°é¢‘ç‡
   - å»¶è¿Ÿéå…³é”®è®¡ç®—
   - å†…å­˜æ± å¤ç”¨</p>
</li>
</ol>
</details>
<h2 id="_12">å¸¸è§é™·é˜±ä¸é”™è¯¯</h2>
<h3 id="1">1. å®šä½ç³»ç»Ÿ</h3>
<p><strong>é™·é˜±ï¼šåˆå§‹ä½å§¿è®¾ç½®é”™è¯¯</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># é”™è¯¯ï¼šæœªè®¾ç½®åˆå§‹ä½å§¿å°±å¯åŠ¨å¯¼èˆª</span>
ros2<span class="w"> </span>run<span class="w"> </span>nav2_bringup<span class="w"> </span>navigation_launch.py

<span class="c1"># æ­£ç¡®ï¼šå…ˆè®¾ç½®åˆå§‹ä½å§¿</span>
ros2<span class="w"> </span>topic<span class="w"> </span>pub<span class="w"> </span>/initialpose<span class="w"> </span>geometry_msgs/PoseWithCovarianceStamped<span class="w"> </span>...
<span class="c1"># æˆ–åœ¨ rviz2 ä¸­ä½¿ç”¨ 2D Pose Estimate</span>
</code></pre></div>

<p><strong>é™·é˜±ï¼šåæ ‡ç³»é…ç½®æ··ä¹±</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># é”™è¯¯ï¼šworld_frame è®¾ç½®ä¸å½“</span>
<span class="nt">world_frame</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">map</span><span class="w">  </span><span class="c1"># EKF åº”è¯¥æ˜¯ odom</span>

<span class="c1"># æ­£ç¡®é…ç½®</span>
<span class="nt">ekf_odom</span><span class="p">:</span>
<span class="w">  </span><span class="nt">world_frame</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">odom</span>
<span class="nt">ekf_map</span><span class="p">:</span>
<span class="w">  </span><span class="nt">world_frame</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">map</span>
</code></pre></div>

<h3 id="2-slam">2. SLAM å»ºå›¾</h3>
<p><strong>é™·é˜±ï¼šå›ç¯è¯¯åŒ¹é…</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># é—®é¢˜ï¼šé˜ˆå€¼è¿‡ä½å¯¼è‡´é”™è¯¯å›ç¯</span>
<span class="n">loop_match_minimum_response_coarse</span><span class="p">:</span> <span class="mf">0.1</span>  <span class="c1"># å¤ªä½</span>

<span class="c1"># è§£å†³ï¼šæé«˜é˜ˆå€¼ï¼Œå¢åŠ éªŒè¯</span>
<span class="n">loop_match_minimum_response_coarse</span><span class="p">:</span> <span class="mf">0.35</span>
<span class="n">loop_match_minimum_chain_size</span><span class="p">:</span> <span class="mi">10</span>
</code></pre></div>

<p><strong>é™·é˜±ï¼šåœ°å›¾æ¼‚ç§»ç´¯ç§¯</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># é—®é¢˜ï¼šçº¯é‡Œç¨‹è®¡å»ºå›¾</span>
<span class="nt">slam_toolbox</span><span class="p">:</span>
<span class="w">  </span><span class="nt">use_scan_matching</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># é”™è¯¯</span>

<span class="c1"># è§£å†³ï¼šå¯ç”¨æ‰«æåŒ¹é…</span>
<span class="w">  </span><span class="nt">use_scan_matching</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">scan_matcher_variance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
</code></pre></div>

<h3 id="3">3. ä¼ æ„Ÿå™¨èåˆ</h3>
<p><strong>é™·é˜±ï¼šæ—¶é—´æˆ³ä¸åŒæ­¥</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># é—®é¢˜ï¼šç›´æ¥ä½¿ç”¨åŸå§‹æ—¶é—´æˆ³</span>
<span class="n">imu_msg</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">sensor_time</span>

<span class="c1"># è§£å†³ï¼šæ—¶é—´åŒæ­¥</span>
<span class="n">imu_msg</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_clock</span><span class="p">()</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">to_msg</span><span class="p">()</span>
<span class="c1"># æˆ–ä½¿ç”¨ message_filters åŒæ­¥</span>
</code></pre></div>

<p><strong>é™·é˜±ï¼šåæ–¹å·®è®¾ç½®ä¸å½“</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># é—®é¢˜ï¼šè¿‡åº¦ä¿¡ä»»æŸä¼ æ„Ÿå™¨</span>
<span class="nt">odom0_config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">...</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># ä½¿ç”¨æ‰€æœ‰ç»´åº¦</span>

<span class="c1"># è§£å†³ï¼šé€‰æ‹©å¯é ç»´åº¦</span>
<span class="nt">odom0_config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="c1"># ä½ç½®ä¸å¯é </span>
<span class="w">               </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="c1"># å§¿æ€ä¸å¯é   </span>
<span class="w">               </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="c1"># çº¿é€Ÿåº¦å¯é </span>
<span class="w">               </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">]</span><span class="w">   </span><span class="c1"># è§’é€Ÿåº¦å¯é </span>
</code></pre></div>

<h3 id="4">4. æ€§èƒ½é—®é¢˜</h3>
<p><strong>é™·é˜±ï¼šç²’å­æ•°è¿‡å¤š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># é—®é¢˜ï¼šç›²ç›®å¢åŠ ç²’å­æ•°</span>
<span class="nt">max_particles</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class="w">  </span><span class="c1"># CPU è´Ÿè½½è¿‡é«˜</span>

<span class="c1"># è§£å†³ï¼šè‡ªé€‚åº”ç²’å­æ•°</span>
<span class="nt">min_particles</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="nt">max_particles</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2000</span>
<span class="nt">kld_err</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span>
<span class="nt">kld_z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.99</span>
</code></pre></div>

<h2 id="_13">æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•</h2>
<h3 id="_14">ç³»ç»Ÿè®¾è®¡å®¡æŸ¥</h3>
<ul>
<li>[ ] <strong>ä¼ æ„Ÿå™¨é€‰æ‹©</strong></li>
<li>[ ] ä¼ æ„Ÿå™¨ç»„åˆæ»¡è¶³ç²¾åº¦è¦æ±‚</li>
<li>[ ] è€ƒè™‘ç¯å¢ƒé™åˆ¶ï¼ˆå®¤å†…/å®¤å¤–ï¼‰</li>
<li>
<p>[ ] å†—ä½™è®¾è®¡åº”å¯¹æ•…éšœ</p>
</li>
<li>
<p>[ ] <strong>ç®—æ³•é€‰æ‹©</strong></p>
</li>
<li>[ ] AMCL vs SLAM åœºæ™¯é€‚é…</li>
<li>[ ] EKF vs UKF éçº¿æ€§ç¨‹åº¦</li>
<li>
<p>[ ] 2D vs 3D éœ€æ±‚åŒ¹é…</p>
</li>
<li>
<p>[ ] <strong>åœ°å›¾ç®¡ç†</strong></p>
</li>
<li>[ ] åœ°å›¾æ ¼å¼æ ‡å‡†åŒ–</li>
<li>[ ] æ›´æ–°ç­–ç•¥æ˜ç¡®</li>
<li>[ ] å­˜å‚¨å’Œä¼ è¾“ä¼˜åŒ–</li>
</ul>
<h3 id="_15">å‚æ•°è°ƒä¼˜</h3>
<ul>
<li>[ ] <strong>AMCL è°ƒä¼˜</strong></li>
<li>[ ] ç²’å­æ•°é‡ä¸CPUå¹³è¡¡</li>
<li>[ ] è¿åŠ¨æ¨¡å‹åŒ¹é…æœºå™¨äººç‰¹æ€§</li>
<li>
<p>[ ] è§‚æµ‹æ¨¡å‹é€‚åº”ä¼ æ„Ÿå™¨ç‰¹ç‚¹</p>
</li>
<li>
<p>[ ] <strong>SLAM è°ƒä¼˜</strong></p>
</li>
<li>[ ] æ‰«æåŒ¹é…å‚æ•°éªŒè¯</li>
<li>[ ] å›ç¯æ£€æµ‹é˜ˆå€¼æµ‹è¯•</li>
<li>
<p>[ ] ä¼˜åŒ–é¢‘ç‡è®¾ç½®åˆç†</p>
</li>
<li>
<p>[ ] <strong>èåˆè°ƒä¼˜</strong></p>
</li>
<li>[ ] ä¼ æ„Ÿå™¨æƒé‡åˆç†åˆ†é…</li>
<li>[ ] è¿‡ç¨‹å™ªå£°åæ˜ å®é™…æƒ…å†µ</li>
<li>[ ] å¼‚å¸¸å€¼æ£€æµ‹å¯ç”¨</li>
</ul>
<h3 id="_16">æµ‹è¯•éªŒè¯</h3>
<ul>
<li>[ ] <strong>åŠŸèƒ½æµ‹è¯•</strong></li>
<li>[ ] é™æ€å®šä½ç²¾åº¦ &lt; è¦æ±‚å€¼</li>
<li>[ ] åŠ¨æ€è·Ÿè¸ªç¨³å®š</li>
<li>
<p>[ ] å»ºå›¾å®Œæ•´æ€§éªŒè¯</p>
</li>
<li>
<p>[ ] <strong>é²æ£’æ€§æµ‹è¯•</strong></p>
</li>
<li>[ ] ä¼ æ„Ÿå™¨æ•…éšœå¤„ç†</li>
<li>[ ] ç»‘æ¶é—®é¢˜æ¢å¤</li>
<li>
<p>[ ] åŠ¨æ€ç¯å¢ƒé€‚åº”</p>
</li>
<li>
<p>[ ] <strong>æ€§èƒ½æµ‹è¯•</strong></p>
</li>
<li>[ ] CPU ä½¿ç”¨ç‡ &lt; é™åˆ¶</li>
<li>[ ] å†…å­˜å ç”¨ç¨³å®š</li>
<li>[ ] æ›´æ–°é¢‘ç‡è¾¾æ ‡</li>
</ul>
<h3 id="_17">éƒ¨ç½²æ£€æŸ¥</h3>
<ul>
<li>[ ] <strong>æ—¥å¿—ç›‘æ§</strong></li>
<li>[ ] å…³é”®æŒ‡æ ‡è®°å½•</li>
<li>[ ] å¼‚å¸¸äº‹ä»¶å‘Šè­¦</li>
<li>
<p>[ ] æ€§èƒ½ç»Ÿè®¡åˆ†æ</p>
</li>
<li>
<p>[ ] <strong>ç»´æŠ¤æ–¹æ¡ˆ</strong></p>
</li>
<li>[ ] åœ°å›¾æ›´æ–°æµç¨‹</li>
<li>[ ] å‚æ•°è°ƒæ•´æœºåˆ¶</li>
<li>
<p>[ ] æ•…éšœæ¢å¤é¢„æ¡ˆ</p>
</li>
<li>
<p>[ ] <strong>æ–‡æ¡£å®Œå¤‡</strong></p>
</li>
<li>[ ] å‚æ•°è¯´æ˜æ–‡æ¡£</li>
<li>[ ] è°ƒè¯•æŒ‡å—</li>
<li>[ ] å¸¸è§é—®é¢˜FAQ</li>
</ul>
            </article>
            
            <nav class="page-nav"><a href="chapter10.html" class="nav-link prev">â† ç¬¬ 10 ç« ï¼šä¼ æ„Ÿå™¨æ•°æ®å¤„ç†ç®¡é“</a><a href="chapter12.html" class="nav-link next">ç¬¬ 12 ç« ï¼šå¯¼èˆªæ ˆ Nav2 â†’</a></nav>
        </main>
    </div>
</body>
</html>